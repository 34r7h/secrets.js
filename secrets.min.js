/*! secrets.js-grempe 2019-09-06 */

!function(e,r){"use strict";"function"==typeof define&&define.amd?define([],function(){return e.secrets=r()}):"object"==typeof exports?module.exports=r(require("crypto")):e.secrets=r(e.crypto)}(this,function(a){"use strict";var u,d,n,i,s,h;function f(){u={bits:8,radix:16,minBits:3,maxBits:20,bytesPerChar:2,maxBytesPerChar:6,primitivePolynomials:[null,null,1,3,3,5,3,3,29,17,9,5,83,27,43,3,45,9,39,39,9,5,3,33,27,9,71,39,9,5,83]},d={},n=new Array(1024).join("0"),i=!0,s=10,h=["nodeCryptoRandomBytes","browserCryptoGetRandomValues","browserSJCLRandom","testRandom"]}function l(){return!(!d||!d.rng||"function"!=typeof d.rng)}function m(e,r){var t;if(0===r||1===r)return e;if(r&&1024<r)throw new Error("Padding must be multiples of no larger than 1024 bits.");return r=r||d.bits,e&&(t=e.length%r),t?(n+e).slice(-(r-t+e.length)):e}function c(e){var r,t,n="";for(t=e.length-1;0<=t;t--){if(r=parseInt(e[t],16),isNaN(r))throw new Error("Invalid hex character.");n=m(r.toString(2),4)+n}return n}function b(e){var r,t,n="";for(t=(e=m(e,4)).length;4<=t;t-=4){if(r=parseInt(e.slice(t-4,t),2),isNaN(r))throw new Error("Invalid binary character.");n=r.toString(16)+n}return n}function p(){return!(!a||"object"!=typeof a||"function"!=typeof a.getRandomValues&&"object"!=typeof a.getRandomValues||"function"!=typeof Uint32Array&&"object"!=typeof Uint32Array)}function g(){return"object"==typeof a&&"function"==typeof a.randomBytes}function w(){return"object"==typeof sjcl&&"object"==typeof sjcl.random}function o(e){function o(e,r,t,n){var i,o=0,a="";for(r&&(i=r.length-1);o<i||a.length<e;)a+=m(Math.abs(parseInt(r[o],t)).toString(2),n),o++;return((a=a.substr(-e)).match(/0/g)||[]).length===a.length?null:a}function r(e){var r,t=null;for(16,4,r=Math.ceil(e/8);null===t;)t=o(e,a.randomBytes(r).toString("hex"),16,4);return t}function t(e){var r,t=null;for(10,32,r=Math.ceil(e/32);null===t;)t=o(e,a.getRandomValues(new Uint32Array(r)),10,32);return t}function n(e){var r;if(10,32,r=Math.ceil(e/32),!sjcl.random.isReady(s))throw new Error("SJCL isn't finished seeding the RNG yet.");return o(e,sjcl.random.randomWords(r,s),10,32)}return e&&"testRandom"===e?(d.typeCSPRNG=e,function(e){var r,t,n=null;t=Math.ceil(e/32),r=new Uint32Array(t);for(var i=0;i<r.length;i++)r[i]=123456789;for(;null===n;)n=o(e,r,10,32);return n}):e&&"nodeCryptoRandomBytes"===e?(d.typeCSPRNG=e,r):e&&"browserCryptoGetRandomValues"===e?(d.typeCSPRNG=e,t):e&&"browserSJCLRandom"===e?(i=!1,d.typeCSPRNG=e,n):g()?(d.typeCSPRNG="nodeCryptoRandomBytes",r):p()?(d.typeCSPRNG="browserCryptoGetRandomValues",t):w()?(i=!1,d.typeCSPRNG="browserSJCLRandom",n):void 0}function y(e,r){var t,n=[];for(r&&(e=m(e,r)),t=e.length;t>d.bits;t-=d.bits)n.push(parseInt(e.slice(t-d.bits,t),2));return n.push(parseInt(e.slice(0,t),2)),n}function S(e,r){var t,n=d.logs[e],i=0;for(t=r.length-1;0<=t;t--)i=0!==i?d.exps[(n+d.logs[i])%d.maxShares]^r[t]:r[t];return i}function x(e,r,t){var n,i,o,a,s=0;for(o=0,n=r.length;o<n;o++)if(t[o]){for(i=d.logs[t[o]],a=0;a<n;a++)if(o!==a){if(e===r[a]){i=-1;break}i=(i+d.logs[e^r[a]]-d.logs[r[o]^r[a]]+d.maxShares)%d.maxShares}s=-1===i?s:s^d.exps[i]}return s}function v(e,r,t){var n,i,o=[],a=[e];for(n=1;n<t;n++)a[n]=parseInt(d.rng(d.bits),2);for(i=r+(n=1);n<i;n++)o[n-1]={x:n,y:S(n,a)};return o}function R(e,r,t){var n,i,o,a;if(r=parseInt(r,d.radix),n=(e=parseInt(e,10)||d.bits).toString(36).toUpperCase(),a=(o=Math.pow(2,e)-1).toString(d.radix).length,i=m(r.toString(d.radix),a),"number"!=typeof r||r%1!=0||r<1||o<r)throw new Error("Share id must be an integer between 1 and "+o+", inclusive.");return n+i+t}var e={init:function(e,r){var t,n,i=[],o=[],a=1;if(f(),e&&("number"!=typeof e||e%1!=0||e<u.minBits||e>u.maxBits))throw new Error("Number of bits must be an integer between "+u.minBits+" and "+u.maxBits+", inclusive.");if(r&&-1===h.indexOf(r))throw new Error("Invalid RNG type argument : '"+r+"'");for(d.radix=u.radix,d.bits=e||u.bits,d.size=Math.pow(2,d.bits),d.maxShares=d.size-1,t=u.primitivePolynomials[d.bits],n=0;n<d.size;n++)i[o[n]=a]=n,(a<<=1)>=d.size&&(a^=t,a&=d.maxShares);if(d.logs=i,d.exps=o,r&&this.setRNG(r),l()||this.setRNG(),w()&&"browserSJCLRandom"===d.typeCSPRNG&&(sjcl.random=new sjcl.prng(s),p()&&sjcl.random.startCollectors(),this.seedRNG()),!(l()&&d.bits&&d.size&&d.maxShares&&d.logs&&d.exps&&d.logs.length===d.size&&d.exps.length===d.size))throw new Error("Initialization failed.")},seedRNG:function(e,r,t){var n,i;r=parseInt(r,10),t=t||"seedRNG",w()&&p()&&(n=new Uint32Array(256),i=a.getRandomValues(n),sjcl.random.addEntropy(i,2048,"cryptoGetRandomValues")),w()&&g()&&a.randomBytes(256,function(e,r){if(e)throw e;sjcl.random.addEntropy(r.toString("hex"),2048,"cryptoRandomBytes")}),w()&&e&&r&&t&&"browserSJCLRandom"===d.typeCSPRNG&&sjcl.random.addEntropy(e,r,t)},combine:function(e,r){var t,n,i,o,a,s,h,u="",f=[],l=[];for(r=r||0,t=0,i=e.length;t<i;t++){if(s=this.extractShareComponents(e[t]),void 0===a)a=s.bits;else if(s.bits!==a)throw new Error("Mismatched shares: Different bit settings.");if(d.bits!==a&&this.init(a),-1===f.indexOf(s.id))for(f.push(s.id),n=0,o=(h=y(c(s.data))).length;n<o;n++)l[n]=l[n]||[],l[n][f.length-1]=h[n]}for(t=0,i=l.length;t<i;t++)u=m(x(r,f,l[t]).toString(2))+u;return b(1<=r?u:u.slice(u.indexOf("1")+1))},getConfig:function(){var e={};return e.radix=d.radix,e.bits=d.bits,e.maxShares=d.maxShares,e.hasCSPRNG=l(),e.typeCSPRNG=d.typeCSPRNG,e},extractShareComponents:function(e){var r,t,n,i,o,a={};if((r=parseInt(e.substr(0,1),36))&&("number"!=typeof r||r%1!=0||r<u.minBits||r>u.maxBits))throw new Error("Invalid share : Number of bits must be an integer between "+u.minBits+" and "+u.maxBits+", inclusive.");if(i=Math.pow(2,r)-1,n=(Math.pow(2,r)-1).toString(d.radix).length,(o=new RegExp("^([a-kA-K3-9]{1})([a-fA-F0-9]{"+n+"})([a-fA-F0-9]+)$").exec(e))&&(t=parseInt(o[2],d.radix)),"number"!=typeof t||t%1!=0||t<1||i<t)throw new Error("Invalid share : Share id must be an integer between 1 and "+d.maxShares+", inclusive.");if(o&&o[3])return a.bits=r,a.id=t,a.data=o[3],a;throw new Error("The share data provided is invalid : "+e)},setRNG:function(e){var r="Random number generator is invalid ",t=" Supply an CSPRNG of the form function(bits){} that returns a string containing 'bits' number of random 1's and 0's.";if(e&&"string"==typeof e&&-1===h.indexOf(e))throw new Error("Invalid RNG type argument : '"+e+"'");if((e=e||o())&&"string"==typeof e&&(e=o(e)),i){if(e&&"function"!=typeof e)throw new Error(r+"(Not a function)."+t);if(e&&"string"!=typeof e(d.bits))throw new Error(r+"(Output is not a string)."+t);if(e&&!parseInt(e(d.bits),2))throw new Error(r+"(Binary string output not parseable to an Integer)."+t);if(e&&e(d.bits).length>d.bits)throw new Error(r+"(Output length is greater than config.bits)."+t);if(e&&e(d.bits).length<d.bits)throw new Error(r+"(Output length is less than config.bits)."+t)}return d.rng=e,!0},str2hex:function(e,r){var t,n,i,o,a,s,h="";if("string"!=typeof e)throw new Error("Input must be a character string.");if("number"!=typeof(r=r||u.bytesPerChar)||r<1||r>u.maxBytesPerChar||r%1!=0)throw new Error("Bytes per character must be an integer between 1 and "+u.maxBytesPerChar+", inclusive.");for(t=2*r,n=Math.pow(16,t)-1,a=0,s=e.length;a<s;a++){if(o=e[a].charCodeAt(),isNaN(o))throw new Error("Invalid character: "+e[a]);if(n<o)throw i=Math.ceil(Math.log(o+1)/Math.log(256)),new Error("Invalid character code ("+o+"). Maximum allowable is 256^bytes-1 ("+n+"). To convert this character, use at least "+i+" bytes.");h=m(o.toString(16),t)+h}return h},hex2str:function(e,r){var t,n,i,o="";if("string"!=typeof e)throw new Error("Input must be a hexadecimal string.");if("number"!=typeof(r=r||u.bytesPerChar)||r%1!=0||r<1||r>u.maxBytesPerChar)throw new Error("Bytes per character must be an integer between 1 and "+u.maxBytesPerChar+", inclusive.");for(n=0,i=(e=m(e,t=2*r)).length;n<i;n+=t)o=String.fromCharCode(parseInt(e.slice(n,n+t),16))+o;return o},random:function(e){if("number"!=typeof e||e%1!=0||e<2||65536<e)throw new Error("Number of bits must be an Integer between 1 and 65536.");if("browserSJCLRandom"===d.typeCSPRNG&&sjcl.random.isReady(s)<1)throw new Error("SJCL isn't finished seeding the RNG yet. Needs new entropy added or more mouse movement.");return b(d.rng(e))},share:function(e,r,t,n){var i,o,a,s,h,u=new Array(r),f=new Array(r);if(n=n||128,"string"!=typeof e)throw new Error("Secret must be a string.");if("number"!=typeof r||r%1!=0||r<2)throw new Error("Number of shares must be an integer between 2 and 2^bits-1 ("+d.maxShares+"), inclusive.");if(r>d.maxShares)throw i=Math.ceil(Math.log(r+1)/Math.LN2),new Error("Number of shares must be an integer between 2 and 2^bits-1 ("+d.maxShares+"), inclusive. To create "+r+" shares, use at least "+i+" bits.");if("number"!=typeof t||t%1!=0||t<2)throw new Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+d.maxShares+"), inclusive.");if(t>d.maxShares)throw i=Math.ceil(Math.log(t+1)/Math.LN2),new Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+d.maxShares+"), inclusive.  To use a threshold of "+t+", use at least "+i+" bits.");if(r<t)throw new Error("Threshold number of shares was "+t+" but must be less than or equal to the "+r+" shares specified as the total to generate.");if("number"!=typeof n||n%1!=0||n<0||1024<n)throw new Error("Zero-pad length must be an integer between 0 and 1024 inclusive.");for(a=0,h=(e=y(e="1"+c(e),n)).length;a<h;a++)for(o=v(e[a],r,t),s=0;s<r;s++)u[s]=u[s]||o[s].x.toString(d.radix),f[s]=m(o[s].y.toString(2))+(f[s]||"");for(a=0;a<r;a++)u[a]=R(d.bits,u[a],b(f[a]));return u},newShare:function(e,r){if(e&&"string"==typeof e&&(e=parseInt(e,d.radix)),e&&r&&r[0])return R(this.extractShareComponents(r[0]).bits,e,this.combine(r,e));throw new Error("Invalid 'id' or 'shares' Array argument to newShare().")},_reset:f,_padLeft:m,_hex2bin:c,_bin2hex:b,_hasCryptoGetRandomValues:p,_hasCryptoRandomBytes:g,_hasSJCL:w,_getRNG:o,_isSetRNG:l,_splitNumStringToIntArray:y,_horner:S,_lagrange:x,_getShares:v,_constructPublicShareString:R};return e.init(),e});