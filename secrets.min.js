// secrets.js - Copyright (c) 2012 Alexander Stetsyuk
(function(exports, global){
function m(a){throw a;}var q=!0,r=null,s=!1,aa=[r,r,1,3,3,5,3,3,29,17,9,5,83,27,43,3,45,9,39,39,9,5,3,33,27,9,71,39,9,5,83],t="WARNING:\nA secure random number generator was not found.\nUsing Math.random(), which is NOT cryptographically strong!",v,x,y,z,A,B,C,D,E;
exports.init=function(a,b,c){a&&("number"!==typeof a||0!==a%1||3>a||20<a)&&m(Error("Number of bits must be an integer between 3 and 20, inclusive."));b&&("number"!==typeof b||0!==b%1||2>b||36<b)&&m(Error("Radix must be an integer between 2 and 36, inclusive."));c&&("number"!==typeof c||0!==c%1||2>c)&&m(Error("Zero pad length must be an integer greater than 1."));v=a||8;x=b||16;y=c||256;z=Math.pow(2,v);A=z-1;a=[];b=[];c=1;for(var e=aa[v],d=0;d<z;d++)b[d]=c,a[c]=d,c<<=1,c>=z&&(c^=e,c&=A);B=a;C=b};
function F(){return!v||!x||!y||!B||!C||!z||!A||B.length!==z||C.length!==z?s:q}exports.getConfig=function(){return{bits:v,radix:x,padLength:y}};
function ba(){function a(a,b,c,e){for(var h="",k=0,l=b.length-1;k<l||h.length<a;)h+=G(parseInt(b[k],c).toString(2),e),k++;h=h.substr(-a);return(h.match(/0/g)||[]).length===h.length?r:h}var b,c;if("function"===typeof global.require&&(c=global.require("crypto"))&&(b=c.randomBytes))return function(c){for(var e=Math.ceil(c/8),f=r;f===r;)f=a(c,b(e).toString("hex"),16,4);return f};if(global.crypto&&"function"===typeof global.crypto.getRandomValues&&"function"===typeof global.Uint32Array)return c=global.crypto,
function(b){for(var e=r,f=new global.Uint32Array(Math.ceil(b/32));e===r;)c.getRandomValues(f),e=a(b,f,10,32);return e};D=q;H();var e=Math.pow(2,32)-1;return function(b){for(var c=Math.ceil(b/32),f=[],j=r;j===r;){for(j=0;j<c;j++)f[j]=Math.floor(Math.random()*e+1);j=a(b,f,10,32)}return j}}function H(){global.console.warn(t);"function"===typeof global.alert&&global.alert(t)}
exports.setRNG=function(a){F()||this.init();a=a||ba();("function"!==typeof a||"string"!==typeof a(v)||!parseInt(a(v),2)||a(v).length>v||a(v).length<v)&&m(Error("Random number generator is invalid. Supply an RNG of the form function(bits){} that returns a string containing 'bits' number of random 1's and 0's."));E=a};
exports.random=function(a){"function"!==typeof E&&this.setRNG();D&&H();("number"!==typeof a||0!==a%1||2>a)&&m(Error("Number of bits must be an integer greater than 1."));return this.convertBase(E(a),2,16)};
exports.share=function(a,b,c,e,d,g){F()||this.init();"function"!==typeof E&&this.setRNG();D&&H();e=!!e;d=d||x;g=g||x;"string"!==typeof a&&m(Error("Secret must be a string."));("number"!==typeof d||0!==d%1||2>d||36<d)&&m(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof g||0!==g%1||2>g||36<g)&&m(Error("Output radix must be an integer between 2 and 36, inclusive."));("number"!==typeof b||0!==b%1||2>b)&&m(Error("Number of shares must be an integer between 2 and 2^bits-1 ("+
A+"), inclusive."));if(b>A){var f=Math.ceil(Math.log(b+1)/Math.log(2));m(Error("Number of shares must be an integer between 2 and 2^bits-1 ("+A+"), inclusive. To create "+b+" shares, use at least "+f+" bits."))}("number"!==typeof c||0!==c%1||2>c)&&m(Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+A+"), inclusive."));c>A&&(f=Math.ceil(Math.log(c+1)/Math.log(2)),m(Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+A+"), inclusive.  To use a threshold of "+
c+", use at least "+f+" bits.")));a=I(a,d,e);e=Array(b);d=Array(b);for(var f=0,j=a.length;f<j;f++){for(var h=b,k=c,l=[],n=[a[f]],p=1;p<k;p++)n[p]=parseInt(E(v),2);p=1;for(h+=1;p<h;p++){for(var k=B[p],w=0,u=n.length-1;0<=u;u--)w=0===w?n[u]:C[(k+B[w])%A]^n[u];l[p-1]={x:p,y:w}}subShares=l;for(l=0;l<b;l++)e[l]=e[l]||subShares[l].x.toString(g),d[l]=G(subShares[l].y.toString(2))+(d[l]?d[l]:"")}for(f=0;f<b;f++)e[f]=e[f]+"-"+(new J(d[f],2)).toString(g);return e};
function I(a,b,c){a=(new J(a,b)).toString(2);c&&(a=G(a,y));b=[];for(c=a.length;c>v;c-=v)b.push(parseInt(a.slice(c-v,c),2));b.push(parseInt(a.slice(0,c),2));return b}function G(a,b){b=b||v;var c=a.length%b;return(c?Array(b-c+1).join("0"):"")+a}
exports.newShare=function(a,b,c){F()||this.init();c=c||x;("number"!==typeof c||0!==c%1||2>c||36<c)&&m(Error("Radix must be an integer between 2 and 36, inclusive."));"string"===typeof a&&(a=parseInt(a,c));("number"!==typeof a||0!==a%1||1>a||a>A)&&m(Error("Share id must be an integer between 1 and "+A+", inclusive."));return a.toString(c)+"-"+K(a,b,c,c)};
function K(a,b,c,e){for(var d=[],g=[],f=[],j="",h,k=0,l=b.length;k<l;k++){"string"===typeof b[k]?(d=b[k].split("-"),2!==d.length&&m(Error("Invalid share:\n"+b[k]))):"object"===typeof b[k]?(d[0]=b[k].id.toString(),d[1]=b[k].share.toString()):m(Error("Unknown share type:\n"+b[k]));d[0]=parseInt(d[0],c);a:{h=0;for(var n=g.length;h<n;h++)if(g[h]===d[0]){h=q;break a}h=s}if(!h){h=g.push(d[0])-1;d[1]=I(d[1],c);for(var n=0,p=d[1].length;n<p;n++)f[n]=f[n]||[],f[n][h]=d[1][n]}}k=0;for(l=f.length;k<l;k++){b=
f[k];c=0;n=h=d=void 0;h=0;for(p=g.length;h<p;h++)if(b[h]){d=B[b[h]];for(n=0;n<p;n++)if(h!==n){if(a===g[n]){d=-1;break}d=(d+B[a^g[n]]-B[g[h]^g[n]]+A)%A}c=-1===d?c:c^C[d]}j=G(c.toString(2))+j}return(new J(j,2)).toString(e)}
exports.combine=function(a,b,c){F()||this.init();b=b||x;c=c||x;("number"!==typeof b||0!==b%1||2>b||36<b)&&m(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof c||0!==c%1||2>c||36<c)&&m(Error("Output radix must be an integer between 2 and 36, inclusive."));return K(0,a,b,c)};
exports.toHex=function(a,b){"string"!==typeof a&&m(Error("Input must be a character string."));b=b||2;6<b&&m(Error("Maximum bytes per character is 6."));for(var c=2*b,e=Math.pow(16,c)-1,d="",g,f=0,j=a.length;f<j;f++){g=a[f].charCodeAt();isNaN(g)&&m(Error("Invalid character: "+a[f]));if(g>e){var h=Math.ceil(Math.log(g+1)/Math.log(256));m(Error("Invalid character code ("+g+"). Maximum allowable is 256^bytes-1 ("+e+"). To convert this character, use at least "+h+" bytes."))}d+=G(g.toString(16),c)}return d};
exports.toString=function(a,b){"string"!==typeof a&&m(Error("Input must be a hexadecimal string."));b=b||2;6<b&&m(Error("Maximum bytes per character is 6."));var c=2*b,e="";a=G(a,c);for(var d=0,g=a.length;d<g;d+=c)e+=String.fromCharCode(parseInt(a.slice(d,d+c),16));return e};
exports.convertBase=function(a,b,c){"string"!==typeof a&&m(Error("Input must be a number string."));("number"!==typeof b||0!==b%1||2>b||36<b)&&m(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof c||0!==c%1||2>c||36<c)&&m(Error("Output radix must be an integer between 2 and 36, inclusive."));return(new J(a,b)).toString(c)};exports.init();function J(a,b){a!=r&&(b==r&&"string"!=typeof a?L(this,a,256):L(this,a,b))}
J.prototype={toString:function(a){if(0>this.b)return"-"+M(this).toString(a);if(16==a)a=4;else if(8==a)a=3;else if(2==a)a=1;else if(32==a)a=5;else if(4==a)a=2;else{var b;b=a;b==r&&(b=10);if(0==N(this)||2>b||36<b)b="0";else{a=Math.floor(Math.LN2*this.c/Math.log(b));a=Math.pow(b,a);var c=O(a),e=P(),d=P(),g="";for(Q(this,c,e,d);0<N(e);)g=(a+ca(d)).toString(b).substr(1)+g,Q(e,c,e,d);b=ca(d).toString(b)+g}return b}var c=(1<<a)-1,e=s,d="",g=this.a,f=this.c-g*this.c%a;if(0<g--){if(f<this.c&&0<(b=this[g]>>
f))e=q,d=da.charAt(b);for(;0<=g;)f<a?(b=(this[g]&(1<<f)-1)<<a-f,b|=this[--g]>>(f+=this.c-a)):(b=this[g]>>(f-=a)&c,0>=f&&(f+=this.c,--g)),0<b&&(e=q),e&&(d+=da.charAt(b))}return e?d:"0"},abs:function(){return 0>this.b?M(this):this},copyTo:function(a){for(var b=this.a-1;0<=b;--b)a[b]=this[b];a.a=this.a;a.b=this.b}};function M(a){var b=P();R(S,a,b);return b}
function ca(a){if(0>a.b){if(1==a.a)return a[0]-a.f;if(0==a.a)return-1}else{if(1==a.a)return a[0];if(0==a.a)return 0}return(a[1]&(1<<32-a.c)-1)<<a.c|a[0]}function R(a,b,c){for(var e=0,d=0,g=Math.min(b.a,a.a);e<g;)d+=a[e]-b[e],c[e++]=d&a.d,d>>=a.c;if(b.a<a.a){for(d-=b.b;e<a.a;)d+=a[e],c[e++]=d&a.d,d>>=a.c;d+=a.b}else{for(d+=a.b;e<b.a;)d-=b[e],c[e++]=d&a.d,d>>=a.c;d-=b.b}c.b=0>d?-1:0;-1>d?c[e++]=a.f+d:0<d&&(c[e++]=d);c.a=e;T(c)}
function ea(a,b,c){var e=b%a.c,d=a.c-e,g=(1<<d)-1;b=Math.floor(b/a.c);var f=a.b<<e&a.d,j;for(j=a.a-1;0<=j;--j)c[j+b+1]=a[j]>>d|f,f=(a[j]&g)<<e;for(j=b-1;0<=j;--j)c[j]=0;c[b]=f;c.a=a.a+b+1;c.b=a.b;T(c)}function V(a,b,c){var e;for(e=a.a-1;0<=e;--e)c[e+b]=a[e];for(e=b-1;0<=e;--e)c[e]=0;c.a=a.a+b;c.b=a.b}function fa(a,b){var c=a.b-b.b;if(0!=c)return c;var e=a.a,c=e-b.a;if(0!=c)return 0>a.b?-c:c;for(;0<=--e;)if(0!=(c=a[e]-b[e]))return c;return 0}
function N(a){return 0>a.b?-1:0>=a.a||1==a.a&&0>=a[0]?0:1}
function Q(a,b,c,e){var d=b.abs();if(!(0>=d.a)){var g=a.abs();if(g.a<d.a)c!=r&&W(c,0),e!=r&&a.copyTo(e);else{e==r&&(e=P());var f=P(),j=a.b;b=b.b;var h=d[d.a-1],k=1,l;if(0!=(l=h>>>16))h=l,k+=16;if(0!=(l=h>>8))h=l,k+=8;if(0!=(l=h>>4))h=l,k+=4;if(0!=(l=h>>2))h=l,k+=2;0!=h>>1&&(k+=1);h=a.c-k;0<h?(ea(d,h,f),ea(g,h,e)):(d.copyTo(f),g.copyTo(e));d=f.a;g=f[d-1];if(0!=g){l=g*(1<<a.g)+(1<d?f[d-2]>>a.h:0);k=a.i/l;l=(1<<a.g)/l;var n=1<<a.h,p=e.a,w=p-d,u=c==r?P():c;V(f,w,u);0<=fa(e,u)&&(e[e.a++]=1,R(e,u,e));V(ga,
d,u);for(R(u,f,f);f.a<d;)f[f.a++]=0;for(;0<=--w;){var U=e[--p]==g?a.d:Math.floor(e[p]*k+(e[p-1]+n)*l);if((e[p]+=f.e(0,U,e,w,0,d))<U){V(f,w,u);for(R(e,u,e);e[p]<--U;)R(e,u,e)}}if(c!=r){a=e;for(f=d;f<a.a;++f)c[f-d]=a[f];c.a=Math.max(a.a-d,0);c.b=a.b;j!=b&&R(S,c,c)}e.a=d;T(e);if(0<h)if(b=c=e,b.b=c.b,a=Math.floor(h/c.c),a>=c.a)b.a=0;else{h%=c.c;f=c.c-h;d=(1<<h)-1;b[0]=c[a]>>h;for(g=a+1;g<c.a;++g)b[g-a-1]|=(c[g]&d)<<f,b[g-a]=c[g]>>h;0<h&&(b[c.a-a-1]|=(c.b&d)<<f);b.a=c.a-a;T(b)}0>j&&R(S,e,e)}}}}
function ha(a,b){var c=0;if(0!=b){for(;a.a<=c;)a[a.a++]=0;for(a[c]+=b;a[c]>=a.f;)a[c]-=a.f,++c>=a.a&&(a[a.a++]=0),++a[c]}}function T(a){for(var b=a.b&a.d;0<a.a&&a[a.a-1]==b;)--a.a}function ia(a,b){a[a.a]=a.e(0,b-1,a,0,0,a.a);++a.a;T(a)}function W(a,b){a.a=1;a.b=0>b?-1:0;0<b?a[0]=b:-1>b?a[0]=b+DV:a.a=0}
function L(a,b,c){if(16==c)c=4;else if(8==c)c=3;else if(256==c)c=8;else if(2==c)c=1;else if(32==c)c=5;else if(4==c)c=2;else{W(a,0);c==r&&(c=10);for(var e=Math.floor(Math.LN2*a.c/Math.log(c)),d=Math.pow(c,e),g=s,f=0,j=0,h=0;h<b.length;++h){var k=ja(b,h);0>k?"-"==b.charAt(h)&&0==N(a)&&(g=q):(j=c*j+k,++f>=e&&(ia(a,d),ha(a,j),j=f=0))}0<f&&(ia(a,Math.pow(c,f)),ha(a,j));g&&R(S,a,a);return}a.a=0;a.b=0;e=b.length;d=s;for(g=0;0<=--e;)f=8==c?b[e]&255:ja(b,e),0>f?"-"==b.charAt(e)&&(d=q):(d=s,0==g?a[a.a++]=f:
g+c>a.c?(a[a.a-1]|=(f&(1<<a.c-g)-1)<<g,a[a.a++]=f>>a.c-g):a[a.a-1]|=f<<g,g+=c,g>=a.c&&(g-=a.c));8==c&&0!=(b[0]&128)&&(a.b=-1,0<g&&(a[a.a-1]|=(1<<a.c-g)-1<<g));T(a);d&&R(S,a,a)}function ka(a,b,c,e,d,g){for(;0<=--g;){var f=b*this[a++]+c[e]+d;d=Math.floor(f/67108864);c[e++]=f&67108863}return d}
function la(a,b,c,e,d,g){var f=b&32767;for(b>>=15;0<=--g;){var j=this[a]&32767,h=this[a++]>>15,k=b*j+h*f,j=f*j+((k&32767)<<15)+c[e]+(d&1073741823);d=(j>>>30)+(k>>>15)+b*h+(d>>>30);c[e++]=j&1073741823}return d}function ma(a,b,c,e,d,g){var f=b&16383;for(b>>=14;0<=--g;){var j=this[a]&16383,h=this[a++]>>14,k=b*j+h*f,j=f*j+((k&16383)<<14)+c[e]+d;d=(j>>28)+(k>>14)+b*h;c[e++]=j&268435455}return d}function ja(a,b){var c=X[a.charCodeAt(b)];return c==r?-1:c}var Y;
global.navigator&&global.navigator.appName?"Microsoft Internet Explorer"==global.navigator.appName?(J.prototype.e=la,Y=30):"Netscape"!=global.navigator.appName?(J.prototype.e=ka,Y=26):(J.prototype.e=ma,Y=28):(J.prototype.e=la,Y=30);J.prototype.c=Y;J.prototype.d=(1<<Y)-1;J.prototype.f=1<<Y;J.prototype.i=Math.pow(2,52);J.prototype.g=52-Y;J.prototype.h=2*Y-52;var da="0123456789abcdefghijklmnopqrstuvwxyz",X=[],Z,$;Z=48;for($=0;9>=$;++$)X[Z++]=$;Z=97;for($=10;36>$;++$)X[Z++]=$;Z=65;
for($=10;36>$;++$)X[Z++]=$;function P(){return new J(r)}function O(a){var b=P();W(b,a);return b}var S=O(0),ga=O(1);
})(typeof module !== 'undefined' && module['exports'] ? module['exports'] : (window['secrets'] = {}), typeof GLOBAL !== 'undefined' ? GLOBAL : window );