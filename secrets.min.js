!function(r,e){"use strict";"function"==typeof define&&define.amd?define([],function(){return r.secrets=e()}):"object"==typeof exports?module.exports=e(require("crypto")):r.secrets=e(r.crypto)}(this,function(r){"use strict";function e(){return b&&b.rng&&"function"==typeof b.rng?!0:!1}function t(r,e){var t;if(0===e||1===e)return r;if(e&&e>1024)throw new Error("Padding must be multiples of no larger than 1024 bits.");return e=e||b.bits,r&&(t=r.length%e),t?(c+r).slice(-(e-t+r.length)):r}function n(r){var e,n,i="";for(n=r.length-1;n>=0;n--){if(e=parseInt(r[n],16),isNaN(e))throw new Error("Invalid hex character.");i=t(e.toString(2),4)+i}return i}function i(r){var e,n,i="";for(r=t(r,4),n=r.length;n>=4;n-=4){if(e=parseInt(r.slice(n-4,n),2),isNaN(e))throw new Error("Invalid binary character.");i=e.toString(16)+i}return i}function a(){function e(r,e,n,i){var a,s,o=0,h="";for(e&&(a=e.length-1);a>o||h.length<r;)s=parseInt(e[o],n),h+=t(s.toString(2),i),o++;return h=h.substr(-r),(h.match(/0/g)||[]).length===h.length?null:h}return function(t){var n,i,a,s,o,h=null;if("object"==typeof r&&"function"==typeof r.randomBytes)for(s=16,o=4,i=Math.ceil(t/8);null===h;)n=r.randomBytes(i),h=e(t,n.toString("hex"),s,o);else if(window&&window.crypto&&("function"==typeof window.crypto.getRandomValues||"object"==typeof window.crypto.getRandomValues)&&("function"==typeof Uint32Array||"object"==typeof Uint32Array))for(s=10,o=32,a=Math.ceil(t/32);null===h;)h=e(t,window.crypto.getRandomValues(new Uint32Array(a)),s,o);return h}}function s(r,e){var n,i=[];for(e&&(r=t(r,e)),n=r.length;n>b.bits;n-=b.bits)i.push(parseInt(r.slice(n-b.bits,n),2));return i.push(parseInt(r.slice(0,n),2)),i}function o(r,e){var t,n=b.logs[r],i=0;for(t=e.length-1;t>=0;t--)i=0!==i?b.exps[(n+b.logs[i])%b.maxShares]^e[t]:e[t];return i}function h(r,e,t){var n,i,a,s,o=0;for(a=0,n=e.length;n>a;a++)if(t[a]){for(i=b.logs[t[a]],s=0;n>s;s++)if(a!==s){if(r===e[s]){i=-1;break}i=(i+b.logs[r^e[s]]-b.logs[e[a]^e[s]]+b.maxShares)%b.maxShares}o=-1===i?o:o^b.exps[i]}return o}function u(r,e,t){var n,i,a=[],s=[r];for(n=1;t>n;n++)s[n]=parseInt(b.rng(b.bits),2);for(n=1,i=e+1;i>n;n++)a[n-1]={x:n,y:o(n,s)};return a}function f(r,e,n){var i,a,s,o,h;if(e=parseInt(e,b.radix),r=parseInt(r,10)||b.bits,i=r.toString(36).toUpperCase(),s=Math.pow(2,r)-1,o=s.toString(b.radix).length,a=t(e.toString(b.radix),o),"number"!=typeof e||e%1!==0||1>e||e>s)throw new Error("Share id must be an integer between 1 and "+s+", inclusive.");return h=i+a+n}var l={bits:8,radix:16,minBits:3,maxBits:20,bytesPerChar:2,maxBytesPerChar:6,primitivePolynomials:[null,null,1,3,3,5,3,3,29,17,9,5,83,27,43,3,45,9,39,39,9,5,3,33,27,9,71,39,9,5,83]},b={},c=new Array(1024).join("0"),g={init:function(r){var t,n,i=[],a=[],s=1;if(r&&("number"!=typeof r||r%1!==0||r<l.minBits||r>l.maxBits))throw new Error("Number of bits must be an integer between "+l.minBits+" and "+l.maxBits+", inclusive.");for(b.radix=l.radix,b.bits=r||l.bits,b.size=Math.pow(2,b.bits),b.maxShares=b.size-1,t=l.primitivePolynomials[b.bits],n=0;n<b.size;n++)a[n]=s,i[s]=n,s<<=1,s>=b.size&&(s^=t,s&=b.maxShares);if(b.logs=i,b.exps=a,e()||this.setRNG(),!(e()&&b.bits&&b.size&&b.maxShares&&b.logs&&b.exps&&b.logs.length===b.size&&b.exps.length===b.size))throw new Error("Initialization failed.")},combine:function(r,e){var a,o,u,f,l,c,g,m,w="",p=[],d=[];for(e=e||0,a=0,f=r.length;f>a;a++){if(g=this.extractShareComponents(r[a]),void 0===c)c=g.bits;else if(g.bits!==c)throw new Error("Mismatched shares: Different bit settings.");if(b.bits!==c&&this.init(c),-1===p.indexOf(g.id))for(o=p.push(g.id)-1,m=s(n(g.data)),u=0,l=m.length;l>u;u++)d[u]=d[u]||[],d[u][o]=m[u]}for(a=0,f=d.length;f>a;a++)w=t(h(e,p,d[a]).toString(2))+w;return 0===e?(o=w.indexOf("1"),i(w.slice(o+1))):i(w)},getConfig:function(){var r={};return r.radix=b.radix,r.bits=b.bits,r.maxShares=b.maxShares,r.hasCSPRNG=e(),r},extractShareComponents:function(r){var e,t,n,i,a,s,o={};if(e=parseInt(r.substr(0,1),36),e&&("number"!=typeof e||e%1!==0||e<l.minBits||e>l.maxBits))throw new Error("Invalid share : Number of bits must be an integer between "+l.minBits+" and "+l.maxBits+", inclusive.");if(i=Math.pow(2,e)-1,n=(Math.pow(2,e)-1).toString(b.radix).length,a="^([a-kA-K3-9]{1})([a-fA-F0-9]{"+n+"})([a-fA-F0-9]+)$",s=new RegExp(a).exec(r),s&&(t=parseInt(s[2],b.radix)),"number"!=typeof t||t%1!==0||1>t||t>i)throw new Error("Invalid share : Share id must be an integer between 1 and "+b.maxShares+", inclusive.");if(s&&s[3])return o.bits=e,o.id=t,o.data=s[3],o;throw new Error("The share data provided is invalid : "+r)},setRNG:function(r){var e="Random number generator is invalid ",t=" Supply an CSPRNG of the form function(bits){} that returns a string containing 'bits' number of random 1's and 0's.";if(r||(r=a()),r&&"function"!=typeof r)throw new Error(e+"(Not a function)."+t);if(r&&"string"!=typeof r(b.bits))throw new Error(e+"(Output is not a string)."+t);if(r&&!parseInt(r(b.bits),2))throw new Error(e+"(Binary string output not parseable to an Integer)."+t);if(r&&r(b.bits).length>b.bits)throw new Error(e+"(Output length is greater than config.bits)."+t);if(r&&r(b.bits).length<b.bits)throw new Error(e+"(Output length is less than config.bits)."+t);return b.rng=r,!0},str2hex:function(r,e){var n,i,a,s,o,h,u="";if("string"!=typeof r)throw new Error("Input must be a character string.");if(e||(e=l.bytesPerChar),"number"!=typeof e||1>e||e>l.maxBytesPerChar||e%1!==0)throw new Error("Bytes per character must be an integer between 1 and "+l.maxBytesPerChar+", inclusive.");for(n=2*e,i=Math.pow(16,n)-1,o=0,h=r.length;h>o;o++){if(s=r[o].charCodeAt(),isNaN(s))throw new Error("Invalid character: "+r[o]);if(s>i)throw a=Math.ceil(Math.log(s+1)/Math.log(256)),new Error("Invalid character code ("+s+"). Maximum allowable is 256^bytes-1 ("+i+"). To convert this character, use at least "+a+" bytes.");u=t(s.toString(16),n)+u}return u},hex2str:function(r,e){var n,i,a,s="";if("string"!=typeof r)throw new Error("Input must be a hexadecimal string.");if(e=e||l.bytesPerChar,"number"!=typeof e||e%1!==0||1>e||e>l.maxBytesPerChar)throw new Error("Bytes per character must be an integer between 1 and "+l.maxBytesPerChar+", inclusive.");for(n=2*e,r=t(r,n),i=0,a=r.length;a>i;i+=n)s=String.fromCharCode(parseInt(r.slice(i,i+n),16))+s;return s},random:function(r){if("number"!=typeof r||r%1!==0||2>r||r>65536)throw new Error("Number of bits must be an Integer between 1 and 65536.");return i(b.rng(r))},share:function(r,e,a,o){var h,l,c,g,m,w=new Array(e),p=new Array(e);if(o=o||128,"string"!=typeof r)throw new Error("Secret must be a string.");if("number"!=typeof e||e%1!==0||2>e)throw new Error("Number of shares must be an integer between 2 and 2^bits-1 ("+b.maxShares+"), inclusive.");if(e>b.maxShares)throw h=Math.ceil(Math.log(e+1)/Math.LN2),new Error("Number of shares must be an integer between 2 and 2^bits-1 ("+b.maxShares+"), inclusive. To create "+e+" shares, use at least "+h+" bits.");if("number"!=typeof a||a%1!==0||2>a)throw new Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+b.maxShares+"), inclusive.");if(a>b.maxShares)throw h=Math.ceil(Math.log(a+1)/Math.LN2),new Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+b.maxShares+"), inclusive.  To use a threshold of "+a+", use at least "+h+" bits.");if(a>e)throw new Error("Threshold number of shares was "+a+" but must be less than or equal to the "+e+" shares specified as the total to generate.");if("number"!=typeof o||o%1!==0||0>o||o>1024)throw new Error("Zero-pad length must be an integer between 0 and 1024 inclusive.");for(r="1"+n(r),r=s(r,o),c=0,m=r.length;m>c;c++)for(l=u(r[c],e,a),g=0;e>g;g++)w[g]=w[g]||l[g].x.toString(b.radix),p[g]=t(l[g].y.toString(2))+(p[g]||"");for(c=0;e>c;c++)w[c]=f(b.bits,w[c],i(p[c]));return w},newShare:function(r,e){var t;if(r&&"string"==typeof r&&(r=parseInt(r,b.radix)),r&&e&&e[0])return t=this.extractShareComponents(e[0]),f(t.bits,r,this.combine(e,r));throw new Error("Invalid 'id' or 'shares' Array argument to newShare().")},_padLeft:t,_hex2bin:n,_bin2hex:i,_getRNG:a,_isSetRNG:e,_splitNumStringToIntArray:s,_horner:o,_lagrange:h,_getShares:u,_constructPublicShareString:f};return g.init(),g});