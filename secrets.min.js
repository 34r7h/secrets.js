/*! secrets.js-grempe 2019-10-19 */

!function(e,r){"use strict";"function"==typeof define&&define.amd?define([],function(){return e.secrets=r()}):"object"==typeof exports?module.exports=r(require("crypto")):e.secrets=r(e.crypto)}(this,function(n){"use strict";var u,c,i;function s(){u={bits:8,radix:16,minBits:3,maxBits:20,bytesPerChar:2,maxBytesPerChar:6,primitivePolynomials:[null,null,1,3,3,5,3,3,29,17,9,5,83,27,43,3,45,9,39,39,9,5,3,33,27,9,71,39,9,5,83]},c={},i=new Array(1024).join("0")}function b(e,r){var t;if(0===r||1===r)return e;if(r&&1024<r)throw new Error("Padding must be multiples of no larger than 1024 bits.");return r=r||c.bits,e&&(t=e.length%r),t?(i+e).slice(-(r-t+e.length)):e}function m(e){var r,t,n="";for(t=e.length-1;0<=t;t--){if(r=parseInt(e[t],16),isNaN(r))throw new Error("Invalid hex character.");n=b(r.toString(2),4)+n}return n}function g(e){var r,t,n="";for(t=(e=b(e,4)).length;4<=t;t-=4){if(r=parseInt(e.slice(t-4,t),2),isNaN(r))throw new Error("Invalid binary character.");n=r.toString(16)+n}return n}function o(e){function a(e,r,t,n){var i,a=0,s="";for(r&&(i=r.length-1);a<i||s.length<e;)s+=b(Math.abs(parseInt(r[a],t)).toString(2),n),a++;return((s=s.substr(-e)).match(/0/g)||[]).length===s.length?null:s}if(e&&"testRandom"===e)return function(e){var r,t,n=null;t=Math.ceil(e/32),r=new Uint32Array(t);for(var i=0;i<r.length;i++)r[i]=123456789;for(;null===n;)n=a(e,r,10,32);return n};if("object"==typeof n&&"function"==typeof n.randomBytes)return function(e){var r,t=null;for(16,4,r=Math.ceil(e/8);null===t;)t=a(e,n.randomBytes(r).toString("hex"),16,4);return t};if(n&&"object"==typeof n&&("function"==typeof n.getRandomValues||"object"==typeof n.getRandomValues)&&("function"==typeof Uint32Array||"object"==typeof Uint32Array))return function(e){var r,t=null;for(10,32,r=Math.ceil(e/32);null===t;)t=a(e,n.getRandomValues(new Uint32Array(r)),10,32);return t};throw new Error("No source of cryptographically secure entropy found.")}function w(e,r){var t,n=[];for(r&&(e=b(e,r)),t=e.length;t>c.bits;t-=c.bits)n.push(parseInt(e.slice(t-c.bits,t),2));return n.push(parseInt(e.slice(0,t),2)),n}function h(e,r){var t,n=c.logs[e],i=0;for(t=r.length-1;0<=t;t--)i=0!==i?c.exps[(n+c.logs[i])%c.maxShares]^r[t]:r[t];return i}function d(e,r,t){var n,i,a,s,o=0;for(a=0,n=r.length;a<n;a++)if(t[a]){for(i=c.logs[t[a]],s=0;s<n;s++)if(a!==s){if(e===r[s]){i=-1;break}i=(i+c.logs[e^r[s]]-c.logs[r[a]^r[s]]+c.maxShares)%c.maxShares}o=-1===i?o:o^c.exps[i]}return o}function l(e,r,t){var n,i,a=[],s=[e];for(n=1;n<t;n++)s[n]=parseInt(c.rng(c.bits),2);for(i=r+(n=1);n<i;n++)a[n-1]={x:n,y:h(n,s)};return a}function p(e,r,t){var n,i,a,s;if(r=parseInt(r,c.radix),n=(e=parseInt(e,10)||c.bits).toString(36).toUpperCase(),s=(a=Math.pow(2,e)-1).toString(c.radix).length,i=b(r.toString(c.radix),s),"number"!=typeof r||r%1!=0||r<1||a<r)throw new Error("Share id must be an integer between 1 and "+a+", inclusive.");return n+i+t}var e={init:function(e){var r,t,n=[],i=[],a=1;if(s(),e&&("number"!=typeof e||e%1!=0||e<u.minBits||e>u.maxBits))throw new Error("Number of bits must be an integer between "+u.minBits+" and "+u.maxBits+", inclusive.");for(c.radix=u.radix,c.bits=e||u.bits,c.size=Math.pow(2,c.bits),c.maxShares=c.size-1,r=u.primitivePolynomials[c.bits],t=0;t<c.size;t++)n[i[t]=a]=t,(a<<=1)>=c.size&&(a^=r,a&=c.maxShares);if(c.logs=n,c.exps=i,c.rng=o(),!(c.bits&&c.size&&c.maxShares&&c.logs&&c.exps&&c.logs.length===c.size&&c.exps.length===c.size))throw new Error("Initialization failed.")},combine:function(e,r){var t,n,i,a,s,o,h,u="",f=[],l=[];for(r=r||0,t=0,i=e.length;t<i;t++){if(o=this.extractShareComponents(e[t]),void 0===s)s=o.bits;else if(o.bits!==s)throw new Error("Mismatched shares: Different bit settings.");if(c.bits!==s&&this.init(s),-1===f.indexOf(o.id))for(f.push(o.id),n=0,a=(h=w(m(o.data))).length;n<a;n++)l[n]=l[n]||[],l[n][f.length-1]=h[n]}for(t=0,i=l.length;t<i;t++)u=b(d(r,f,l[t]).toString(2))+u;return g(1<=r?u:u.slice(u.indexOf("1")+1))},getConfig:function(){var e={};return e.radix=c.radix,e.bits=c.bits,e.maxShares=c.maxShares,e},extractShareComponents:function(e){var r,t,n,i,a,s={};if((r=parseInt(e.substr(0,1),36))&&("number"!=typeof r||r%1!=0||r<u.minBits||r>u.maxBits))throw new Error("Invalid share : Number of bits must be an integer between "+u.minBits+" and "+u.maxBits+", inclusive.");if(i=Math.pow(2,r)-1,n=(Math.pow(2,r)-1).toString(c.radix).length,(a=new RegExp("^([a-kA-K3-9]{1})([a-fA-F0-9]{"+n+"})([a-fA-F0-9]+)$").exec(e))&&(t=parseInt(a[2],c.radix)),"number"!=typeof t||t%1!=0||t<1||i<t)throw new Error("Invalid share : Share id must be an integer between 1 and "+c.maxShares+", inclusive.");if(a&&a[3])return s.bits=r,s.id=t,s.data=a[3],s;throw new Error("The share data provided is invalid : "+e)},useUnsafeDeterministicTestRNG:function(){c.rng=o("testRandom")},str2hex:function(e,r){var t,n,i,a,s,o,h="";if("string"!=typeof e)throw new Error("Input must be a character string.");if("number"!=typeof(r=r||u.bytesPerChar)||r<1||r>u.maxBytesPerChar||r%1!=0)throw new Error("Bytes per character must be an integer between 1 and "+u.maxBytesPerChar+", inclusive.");for(t=2*r,n=Math.pow(16,t)-1,s=0,o=e.length;s<o;s++){if(a=e[s].charCodeAt(),isNaN(a))throw new Error("Invalid character: "+e[s]);if(n<a)throw i=Math.ceil(Math.log(a+1)/Math.log(256)),new Error("Invalid character code ("+a+"). Maximum allowable is 256^bytes-1 ("+n+"). To convert this character, use at least "+i+" bytes.");h=b(a.toString(16),t)+h}return h},hex2str:function(e,r){var t,n,i,a="";if("string"!=typeof e)throw new Error("Input must be a hexadecimal string.");if("number"!=typeof(r=r||u.bytesPerChar)||r%1!=0||r<1||r>u.maxBytesPerChar)throw new Error("Bytes per character must be an integer between 1 and "+u.maxBytesPerChar+", inclusive.");for(n=0,i=(e=b(e,t=2*r)).length;n<i;n+=t)a=String.fromCharCode(parseInt(e.slice(n,n+t),16))+a;return a},random:function(e){if("number"!=typeof e||e%1!=0||e<2||65536<e)throw new Error("Number of bits must be an Integer between 1 and 65536.");return g(c.rng(e))},share:function(e,r,t,n){var i,a,s,o,h,u=new Array(r),f=new Array(r);if(n=n||128,"string"!=typeof e)throw new Error("Secret must be a string.");if("number"!=typeof r||r%1!=0||r<2)throw new Error("Number of shares must be an integer between 2 and 2^bits-1 ("+c.maxShares+"), inclusive.");if(r>c.maxShares)throw i=Math.ceil(Math.log(r+1)/Math.LN2),new Error("Number of shares must be an integer between 2 and 2^bits-1 ("+c.maxShares+"), inclusive. To create "+r+" shares, use at least "+i+" bits.");if("number"!=typeof t||t%1!=0||t<2)throw new Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+c.maxShares+"), inclusive.");if(t>c.maxShares)throw i=Math.ceil(Math.log(t+1)/Math.LN2),new Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+c.maxShares+"), inclusive.  To use a threshold of "+t+", use at least "+i+" bits.");if(r<t)throw new Error("Threshold number of shares was "+t+" but must be less than or equal to the "+r+" shares specified as the total to generate.");if("number"!=typeof n||n%1!=0||n<0||1024<n)throw new Error("Zero-pad length must be an integer between 0 and 1024 inclusive.");for(s=0,h=(e=w(e="1"+m(e),n)).length;s<h;s++)for(a=l(e[s],r,t),o=0;o<r;o++)u[o]=u[o]||a[o].x.toString(c.radix),f[o]=b(a[o].y.toString(2))+(f[o]||"");for(s=0;s<r;s++)u[s]=p(c.bits,u[s],g(f[s]));return u},newShare:function(e,r){var t;if(e&&"string"==typeof e&&(e=parseInt(e,c.radix)),t=e.toString(c.radix),e&&t&&r&&r[0])return p(this.extractShareComponents(r[0]).bits,t,this.combine(r,e));throw new Error("Invalid 'id' or 'shares' Array argument to newShare().")},_reset:s,_padLeft:b,_hex2bin:m,_bin2hex:g,_splitNumStringToIntArray:w,_horner:h,_lagrange:d,_getShares:l,_constructPublicShareString:p};return e.init(),e});