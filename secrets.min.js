// secrets.js - Copyright (c) 2012 Alexander Stetsyuk
(function(exports, global){
function l(a){throw a;}var m=!0,p=null,q=!1,aa=[p,p,1,3,3,5,3,3,29,17,9,5,83,27,43,3,45,9,39,39,9,5,3,33,27,9,71,39,9,5,83],r="WARNING:\nA secure random number generator was not found.\nUsing Math.random(), which is NOT cryptographically strong!",s,v,w,x,y,A,B,C,D;
exports.init=function(a,b,c){a&&("number"!==typeof a||0!==a%1||3>a||20<a)&&l(Error("Number of bits must be an integer between 3 and 20, inclusive."));b&&("number"!==typeof b||0!==b%1||2>b||36<b)&&l(Error("Radix must be an integer between 2 and 36, inclusive."));c&&("number"!==typeof c||0!==c%1||2>c)&&l(Error("Zero pad length must be an integer greater than 1."));s=a||8;v=b||16;w=c||256;x=Math.pow(2,s);y=x-1;a=[];b=[];c=1;for(var e=aa[s],d=0;d<x;d++)b[d]=c,a[c]=d,c<<=1,c>=x&&(c^=e,c&=y);A=a;B=b};
function E(){return!s||!v||!w||!A||!B||!x||!y||A.length!==x||B.length!==x?q:m}exports.getConfig=function(){return{bits:s,radix:v,padLength:w}};
function ba(){function a(a,b,c,e){for(var h="",k=0,n=b.length-1;k<n||h.length<a;)h+=F(parseInt(b[k],c).toString(2),e),k++;h=h.substr(-a);return(h.match(/0/g)||[]).length===h.length?p:h}var b,c;if("function"===typeof require&&(c=require("crypto"))&&(b=c.randomBytes))return function(c){for(var e=Math.ceil(c/8),f=p;f===p;)f=a(c,b(e).toString("hex"),16,4);return f};if(global.crypto&&"function"===typeof global.crypto.getRandomValues&&"function"===typeof global.Uint32Array)return c=global.crypto,function(b){for(var e=
p,f=new global.Uint32Array(Math.ceil(b/32));e===p;)c.getRandomValues(f),e=a(b,f,10,32);return e};C=m;G();var e=Math.pow(2,32)-1;return function(b){for(var c=Math.ceil(b/32),f=[],j=p;j===p;){for(j=0;j<c;j++)f[j]=Math.floor(Math.random()*e+1);j=a(b,f,10,32)}return j}}function G(){global.console.warn(r);"function"===typeof global.alert&&global.alert(r)}
exports.setRNG=function(a){E()||this.init();a=a||ba();("function"!==typeof a||"string"!==typeof a(s)||!parseInt(a(s),2)||a(s).length>s||a(s).length<s)&&l(Error("Random number generator is invalid. Supply an RNG of the form function(bits){} that returns a string containing 'bits' number of random 1's and 0's."));D=a};
exports.random=function(a){"function"!==typeof D&&this.setRNG();C&&G();("number"!==typeof a||0!==a%1||2>a)&&l(Error("Number of bits must be an integer greater than 1."));return this.convertBase(D(a),2,16)};
exports.share=function(a,b,c,e,d,g){E()||this.init();"function"!==typeof D&&this.setRNG();C&&G();e=!!e;d=d||v;g=g||v;"string"!==typeof a&&l(Error("Secret must be a string."));("number"!==typeof d||0!==d%1||2>d||36<d)&&l(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof g||0!==g%1||2>g||36<g)&&l(Error("Output radix must be an integer between 2 and 36, inclusive."));("number"!==typeof b||0!==b%1||2>b)&&l(Error("Number of shares must be an integer between 2 and 2^bits-1 ("+
y+"), inclusive."));if(b>y){var f=Math.ceil(Math.log(b+1)/Math.log(2));l(Error("Number of shares must be an integer between 2 and 2^bits-1 ("+y+"), inclusive. To create "+b+" shares, use at least "+f+" bits."))}("number"!==typeof c||0!==c%1||2>c)&&l(Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+y+"), inclusive."));c>y&&(f=Math.ceil(Math.log(c+1)/Math.log(2)),l(Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+y+"), inclusive.  To use a threshold of "+
c+", use at least "+f+" bits.")));a=H(a,d,e);e=Array(b);d=Array(b);for(var f=0,j=a.length;f<j;f++){subShares=this._getShares(a[f],b,c);for(var h=0;h<b;h++)e[h]=e[h]||subShares[h].x.toString(g),d[h]=F(subShares[h].y.toString(2))+(d[h]?d[h]:"")}for(f=0;f<b;f++)e[f]=e[f]+"-"+(new I(d[f],2)).toString(g);return e};function H(a,b,c){a=(new I(a,b)).toString(2);c&&(a=F(a,w));b=[];for(c=a.length;c>s;c-=s)b.push(parseInt(a.slice(c-s,c),2));b.push(parseInt(a.slice(0,c),2));return b}
function F(a,b){b=b||s;var c=a.length%b;return(c?Array(b-c+1).join("0"):"")+a}exports._getShares=function(a,b,c){var e=[];a=[a];for(var d=1;d<c;d++)a[d]=parseInt(D(s),2);d=1;for(b+=1;d<b;d++){c=A[d];for(var g=0,f=a.length-1;0<=f;f--)g=0===g?a[f]:B[(c+A[g])%y]^a[f];e[d-1]={x:d,y:g}}return e};
exports.newShare=function(a,b,c){E()||this.init();c=c||v;("number"!==typeof c||0!==c%1||2>c||36<c)&&l(Error("Radix must be an integer between 2 and 36, inclusive."));"string"===typeof a&&(a=parseInt(a,c));("number"!==typeof a||0!==a%1||1>a||a>y)&&l(Error("Share id must be an integer between 1 and "+y+", inclusive."));return a.toString(c)+"-"+J(a,b,c,c)};
function J(a,b,c,e){for(var d=[],g=[],f=[],j="",h,k=0,n=b.length;k<n;k++){"string"===typeof b[k]?(d=b[k].split("-"),2!==d.length&&l(Error("Invalid share:\n"+b[k]))):"object"===typeof b[k]?(d[0]=b[k].id.toString(),d[1]=b[k].share.toString()):l(Error("Unknown share type:\n"+b[k]));d[0]=parseInt(d[0],c);a:{h=0;for(var t=g.length;h<t;h++)if(g[h]===d[0]){h=m;break a}h=q}if(!h){h=g.push(d[0])-1;d[1]=H(d[1],c);for(var t=0,u=d[1].length;t<u;t++)f[t]=f[t]||[],f[t][h]=d[1][t]}}k=0;for(n=f.length;k<n;k++)j=
F(K(a,g,f[k]).toString(2))+j;return(new I(j,2)).toString(e)}exports.combine=function(a,b,c){E()||this.init();b=b||v;c=c||v;("number"!==typeof b||0!==b%1||2>b||36<b)&&l(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof c||0!==c%1||2>c||36<c)&&l(Error("Output radix must be an integer between 2 and 36, inclusive."));return J(0,a,b,c)};
function K(a,b,c){var e=0,d,g,f;g=0;for(var j=b.length;g<j;g++)if(c[g]){d=A[c[g]];for(f=0;f<j;f++)if(g!==f){if(a===b[f]){d=-1;break}d=(d+A[a^b[f]]-A[b[g]^b[f]]+y)%y}e=-1===d?e:e^B[d]}return e}exports._lagrange=K;
exports.toHex=function(a,b){"string"!==typeof a&&l(Error("Input must be a character string."));b=b||2;("number"!==typeof b||0!==b%1||1>b||6<b)&&l(Error("Bytes per character must be an integer between 1 and 6, inclusive."));for(var c=2*b,e=Math.pow(16,c)-1,d="",g,f=0,j=a.length;f<j;f++){g=a[f].charCodeAt();isNaN(g)&&l(Error("Invalid character: "+a[f]));if(g>e){var h=Math.ceil(Math.log(g+1)/Math.log(256));l(Error("Invalid character code ("+g+"). Maximum allowable is 256^bytes-1 ("+e+"). To convert this character, use at least "+
h+" bytes."))}d+=F(g.toString(16),c)}return d};exports.toString=function(a,b){"string"!==typeof a&&l(Error("Input must be a hexadecimal string."));b=b||2;("number"!==typeof b||0!==b%1||1>b||6<b)&&l(Error("Bytes per character must be an integer between 1 and 6, inclusive."));var c=2*b,e="";a=F(a,c);for(var d=0,g=a.length;d<g;d+=c)e+=String.fromCharCode(parseInt(a.slice(d,d+c),16));return e};
exports.convertBase=function(a,b,c){"string"!==typeof a&&l(Error("Input must be a number string."));("number"!==typeof b||0!==b%1||2>b||36<b)&&l(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof c||0!==c%1||2>c||36<c)&&l(Error("Output radix must be an integer between 2 and 36, inclusive."));return(new I(a,b)).toString(c)};exports.init();function I(a,b){a!=p&&(b==p&&"string"!=typeof a?L(this,a,256):L(this,a,b))}
I.prototype={toString:function(a){if(0>this.b)return"-"+N(this).toString(a);if(16==a)a=4;else if(8==a)a=3;else if(2==a)a=1;else if(32==a)a=5;else if(4==a)a=2;else{var b;b=a;b==p&&(b=10);if(0==O(this)||2>b||36<b)b="0";else{a=Math.floor(Math.LN2*this.c/Math.log(b));a=Math.pow(b,a);var c=P(a),e=Q(),d=Q(),g="";for(ca(this,c,e,d);0<O(e);)g=(a+da(d)).toString(b).substr(1)+g,ca(e,c,e,d);b=da(d).toString(b)+g}return b}var c=(1<<a)-1,e=q,d="",g=this.a,f=this.c-g*this.c%a;if(0<g--){if(f<this.c&&0<(b=this[g]>>
f))e=m,d=ea.charAt(b);for(;0<=g;)f<a?(b=(this[g]&(1<<f)-1)<<a-f,b|=this[--g]>>(f+=this.c-a)):(b=this[g]>>(f-=a)&c,0>=f&&(f+=this.c,--g)),0<b&&(e=m),e&&(d+=ea.charAt(b))}return e?d:"0"},abs:function(){return 0>this.b?N(this):this},copyTo:function(a){for(var b=this.a-1;0<=b;--b)a[b]=this[b];a.a=this.a;a.b=this.b}};function N(a){var b=Q();R(S,a,b);return b}
function da(a){if(0>a.b){if(1==a.a)return a[0]-a.f;if(0==a.a)return-1}else{if(1==a.a)return a[0];if(0==a.a)return 0}return(a[1]&(1<<32-a.c)-1)<<a.c|a[0]}function R(a,b,c){for(var e=0,d=0,g=Math.min(b.a,a.a);e<g;)d+=a[e]-b[e],c[e++]=d&a.d,d>>=a.c;if(b.a<a.a){for(d-=b.b;e<a.a;)d+=a[e],c[e++]=d&a.d,d>>=a.c;d+=a.b}else{for(d+=a.b;e<b.a;)d-=b[e],c[e++]=d&a.d,d>>=a.c;d-=b.b}c.b=0>d?-1:0;-1>d?c[e++]=a.f+d:0<d&&(c[e++]=d);c.a=e;T(c)}
function fa(a,b,c){var e=b%a.c,d=a.c-e,g=(1<<d)-1;b=Math.floor(b/a.c);var f=a.b<<e&a.d,j;for(j=a.a-1;0<=j;--j)c[j+b+1]=a[j]>>d|f,f=(a[j]&g)<<e;for(j=b-1;0<=j;--j)c[j]=0;c[b]=f;c.a=a.a+b+1;c.b=a.b;T(c)}function V(a,b,c){var e;for(e=a.a-1;0<=e;--e)c[e+b]=a[e];for(e=b-1;0<=e;--e)c[e]=0;c.a=a.a+b;c.b=a.b}function ga(a,b){var c=a.b-b.b;if(0!=c)return c;var e=a.a,c=e-b.a;if(0!=c)return 0>a.b?-c:c;for(;0<=--e;)if(0!=(c=a[e]-b[e]))return c;return 0}
function O(a){return 0>a.b?-1:0>=a.a||1==a.a&&0>=a[0]?0:1}
function ca(a,b,c,e){var d=b.abs();if(!(0>=d.a)){var g=a.abs();if(g.a<d.a)c!=p&&W(c,0),e!=p&&a.copyTo(e);else{e==p&&(e=Q());var f=Q(),j=a.b;b=b.b;var h=d[d.a-1],k=1,n;if(0!=(n=h>>>16))h=n,k+=16;if(0!=(n=h>>8))h=n,k+=8;if(0!=(n=h>>4))h=n,k+=4;if(0!=(n=h>>2))h=n,k+=2;0!=h>>1&&(k+=1);h=a.c-k;0<h?(fa(d,h,f),fa(g,h,e)):(d.copyTo(f),g.copyTo(e));d=f.a;g=f[d-1];if(0!=g){n=g*(1<<a.g)+(1<d?f[d-2]>>a.h:0);k=a.i/n;n=(1<<a.g)/n;var t=1<<a.h,u=e.a,M=u-d,z=c==p?Q():c;V(f,M,z);0<=ga(e,z)&&(e[e.a++]=1,R(e,z,e));
V(ha,d,z);for(R(z,f,f);f.a<d;)f[f.a++]=0;for(;0<=--M;){var U=e[--u]==g?a.d:Math.floor(e[u]*k+(e[u-1]+t)*n);if((e[u]+=f.e(0,U,e,M,0,d))<U){V(f,M,z);for(R(e,z,e);e[u]<--U;)R(e,z,e)}}if(c!=p){a=e;for(f=d;f<a.a;++f)c[f-d]=a[f];c.a=Math.max(a.a-d,0);c.b=a.b;j!=b&&R(S,c,c)}e.a=d;T(e);if(0<h)if(b=c=e,b.b=c.b,a=Math.floor(h/c.c),a>=c.a)b.a=0;else{h%=c.c;f=c.c-h;d=(1<<h)-1;b[0]=c[a]>>h;for(g=a+1;g<c.a;++g)b[g-a-1]|=(c[g]&d)<<f,b[g-a]=c[g]>>h;0<h&&(b[c.a-a-1]|=(c.b&d)<<f);b.a=c.a-a;T(b)}0>j&&R(S,e,e)}}}}
function ia(a,b){var c=0;if(0!=b){for(;a.a<=c;)a[a.a++]=0;for(a[c]+=b;a[c]>=a.f;)a[c]-=a.f,++c>=a.a&&(a[a.a++]=0),++a[c]}}function T(a){for(var b=a.b&a.d;0<a.a&&a[a.a-1]==b;)--a.a}function ja(a,b){a[a.a]=a.e(0,b-1,a,0,0,a.a);++a.a;T(a)}function W(a,b){a.a=1;a.b=0>b?-1:0;0<b?a[0]=b:-1>b?a[0]=b+DV:a.a=0}
function L(a,b,c){if(16==c)c=4;else if(8==c)c=3;else if(256==c)c=8;else if(2==c)c=1;else if(32==c)c=5;else if(4==c)c=2;else{W(a,0);c==p&&(c=10);for(var e=Math.floor(Math.LN2*a.c/Math.log(c)),d=Math.pow(c,e),g=q,f=0,j=0,h=0;h<b.length;++h){var k=ka(b,h);0>k?"-"==b.charAt(h)&&0==O(a)&&(g=m):(j=c*j+k,++f>=e&&(ja(a,d),ia(a,j),j=f=0))}0<f&&(ja(a,Math.pow(c,f)),ia(a,j));g&&R(S,a,a);return}a.a=0;a.b=0;e=b.length;d=q;for(g=0;0<=--e;)f=8==c?b[e]&255:ka(b,e),0>f?"-"==b.charAt(e)&&(d=m):(d=q,0==g?a[a.a++]=f:
g+c>a.c?(a[a.a-1]|=(f&(1<<a.c-g)-1)<<g,a[a.a++]=f>>a.c-g):a[a.a-1]|=f<<g,g+=c,g>=a.c&&(g-=a.c));8==c&&0!=(b[0]&128)&&(a.b=-1,0<g&&(a[a.a-1]|=(1<<a.c-g)-1<<g));T(a);d&&R(S,a,a)}function la(a,b,c,e,d,g){for(;0<=--g;){var f=b*this[a++]+c[e]+d;d=Math.floor(f/67108864);c[e++]=f&67108863}return d}
function ma(a,b,c,e,d,g){var f=b&32767;for(b>>=15;0<=--g;){var j=this[a]&32767,h=this[a++]>>15,k=b*j+h*f,j=f*j+((k&32767)<<15)+c[e]+(d&1073741823);d=(j>>>30)+(k>>>15)+b*h+(d>>>30);c[e++]=j&1073741823}return d}function na(a,b,c,e,d,g){var f=b&16383;for(b>>=14;0<=--g;){var j=this[a]&16383,h=this[a++]>>14,k=b*j+h*f,j=f*j+((k&16383)<<14)+c[e]+d;d=(j>>28)+(k>>14)+b*h;c[e++]=j&268435455}return d}function ka(a,b){var c=X[a.charCodeAt(b)];return c==p?-1:c}var Y;
global.navigator&&global.navigator.appName?"Microsoft Internet Explorer"==global.navigator.appName?(I.prototype.e=ma,Y=30):"Netscape"!=global.navigator.appName?(I.prototype.e=la,Y=26):(I.prototype.e=na,Y=28):(I.prototype.e=ma,Y=30);I.prototype.c=Y;I.prototype.d=(1<<Y)-1;I.prototype.f=1<<Y;I.prototype.i=Math.pow(2,52);I.prototype.g=52-Y;I.prototype.h=2*Y-52;var ea="0123456789abcdefghijklmnopqrstuvwxyz",X=[],Z,$;Z=48;for($=0;9>=$;++$)X[Z++]=$;Z=97;for($=10;36>$;++$)X[Z++]=$;Z=65;
for($=10;36>$;++$)X[Z++]=$;function Q(){return new I(p)}function P(a){var b=Q();W(b,a);return b}var S=P(0),ha=P(1);
})(typeof module !== 'undefined' && module['exports'] ? module['exports'] : (window['secrets'] = {}), typeof GLOBAL !== 'undefined' ? GLOBAL : window );