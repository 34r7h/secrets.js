!function(r){"use strict";function e(){return b&&b.rng&&"function"==typeof b.rng?!0:!1}function t(r,e){var t;if(0===e||1===e)return r;if(e&&e>1024)throw new Error("Padding must be multiples of no larger than 1024 bits.");return e=e||b.bits,t=r.length%e,t?(g+r).slice(-(e-t+r.length)):r}function n(r){var e,n,i="";for(n=r.length-1;n>=0;n--){if(e=parseInt(r[n],16),isNaN(e))throw new Error("Invalid hex character.");i=t(e.toString(2),4)+i}return i}function i(r){var e,n,i="";for(r=t(r,4),n=r.length;n>=4;n-=4){if(e=parseInt(r.slice(n-4,n),2),isNaN(e))throw new Error("Invalid binary character.");i=e.toString(16)+i}return i}function a(){function r(r,e,n,i){var a,o=0,s="";for(e&&(a=e.length-1);a>o||s.length<r;)s+=t(parseInt(e[o],n).toString(2),i),o++;return s=s.substr(-r),(s.match(/0/g)||[]).length===s.length?null:s}var e,n;return"function"==typeof require&&(e=require("crypto"))&&(n=e.randomBytes)?function(e){for(var t=Math.ceil(e/8),i=null;null===i;)i=r(e,n(t).toString("hex"),16,4);return i}:!window||!window.crypto||"function"!=typeof window.crypto.getRandomValues&&"object"!=typeof window.crypto.getRandomValues||"function"!=typeof Uint32Array&&"object"!=typeof Uint32Array?null:function(e){for(var t=Math.ceil(e/32),n=null;null===n;)n=r(e,window.crypto.getRandomValues(new Uint32Array(t)),10,32);return n}}function o(r,e){var n,i=[];for(e&&(r=t(r,e)),n=r.length;n>b.bits;n-=b.bits)i.push(parseInt(r.slice(n-b.bits,n),2));return i.push(parseInt(r.slice(0,n),2)),i}function s(r,e){var t,n=b.logs[r],i=0;for(t=e.length-1;t>=0;t--)i=0!==i?b.exps[(n+b.logs[i])%b.maxShares]^e[t]:e[t];return i}function h(r,e,t){var n,i,a,o,s=0;for(a=0,n=e.length;n>a;a++)if(t[a]){for(i=b.logs[t[a]],o=0;n>o;o++)if(a!==o){if(r===e[o]){i=-1;break}i=(i+b.logs[r^e[o]]-b.logs[e[a]^e[o]]+b.maxShares)%b.maxShares}s=-1===i?s:s^b.exps[i]}return s}function u(r,e,t){var n,i,a=[],o=[r];for(n=1;t>n;n++)o[n]=parseInt(b.rng(b.bits),2);for(n=1,i=e+1;i>n;n++)a[n-1]={x:n,y:s(n,o)};return a}function f(r,e,n){var i,a,o,s,h;if(e=parseInt(e,b.radix),r=parseInt(r,10)||b.bits,i=r.toString(36).toUpperCase(),o=Math.pow(2,r)-1,s=o.toString(b.radix).length,a=t(e.toString(b.radix),s),"number"!=typeof e||e%1!==0||1>e||e>o)throw new Error("Share id must be an integer between 1 and "+o+", inclusive.");return h=i+a+n}var l={bits:8,radix:16,minBits:3,maxBits:20,bytesPerChar:2,maxBytesPerChar:6,primitivePolynomials:[null,null,1,3,3,5,3,3,29,17,9,5,83,27,43,3,45,9,39,39,9,5,3,33,27,9,71,39,9,5,83]},b={},g=new Array(1024).join("0");r.init=function(r){var t,n,i=[],a=[],o=1;if(r&&("number"!=typeof r||r%1!==0||r<l.minBits||r>l.maxBits))throw new Error("Number of bits must be an integer between "+l.minBits+" and "+l.maxBits+", inclusive.");for(b.radix=l.radix,b.bits=r||l.bits,b.size=Math.pow(2,b.bits),b.maxShares=b.size-1,t=l.primitivePolynomials[b.bits],n=0;n<b.size;n++)a[n]=o,i[o]=n,o<<=1,o>=b.size&&(o^=t,o&=b.maxShares);if(b.logs=i,b.exps=a,e()||this.setRNG(),!(e()&&b.bits&&b.size&&b.maxShares&&b.logs&&b.exps&&b.logs.length===b.size&&b.exps.length===b.size))throw new Error("Initialization failed.")},r.combine=function(r,e){var a,s,u,f,l,g,c,w,m="",d=[],p=[];for(e=e||0,a=0,f=r.length;f>a;a++){if(c=this.extractShareComponents(r[a]),void 0===g)g=c.bits;else if(c.bits!==g)throw new Error("Mismatched shares: Different bit settings.");if(b.bits!==g&&this.init(g),-1===d.indexOf(c.id))for(s=d.push(c.id)-1,w=o(n(c.data)),u=0,l=w.length;l>u;u++)p[u]=p[u]||[],p[u][s]=w[u]}for(a=0,f=p.length;f>a;a++)m=t(h(e,d,p[a]).toString(2))+m;return 0===e?(s=m.indexOf("1"),i(m.slice(s+1))):i(m)},r.getConfig=function(){var r={};return r.radix=b.radix,r.bits=b.bits,r.maxShares=b.maxShares,r.hasCSPRNG=e(),r},r.extractShareComponents=function(r){var e,t,n,i,a,o,s={};if(e=parseInt(r.substr(0,1),36),e&&("number"!=typeof e||e%1!==0||e<l.minBits||e>l.maxBits))throw new Error("Invalid share : Number of bits must be an integer between "+l.minBits+" and "+l.maxBits+", inclusive.");if(i=Math.pow(2,e)-1,n=(Math.pow(2,e)-1).toString(b.radix).length,a="^([a-kA-K3-9]{1})([a-fA-F0-9]{"+n+"})([a-fA-F0-9]+)$",o=new RegExp(a).exec(r),o&&(t=parseInt(o[2],b.radix)),"number"!=typeof t||t%1!==0||1>t||t>i)throw new Error("Invalid share : Share id must be an integer between 1 and "+b.maxShares+", inclusive.");if(o&&o[3])return s.bits=e,s.id=t,s.data=o[3],s;throw new Error("The share data provided is invalid : "+r)},r.setRNG=function(r){var e="Random number generator is invalid ",t=" Supply an CSPRNG of the form function(bits){} that returns a string containing 'bits' number of random 1's and 0's.";if(r||(r=a()),r&&"function"!=typeof r)throw new Error(e+"(Not a function)."+t);if(r&&"string"!=typeof r(b.bits))throw new Error(e+"(Output is not a string)."+t);if(r&&!parseInt(r(b.bits),2))throw new Error(e+"(Binary string output not parseable to an Integer)."+t);if(r&&r(b.bits).length>b.bits)throw new Error(e+"(Output length is greater than config.bits)."+t);if(r&&r(b.bits).length<b.bits)throw new Error(e+"(Output length is less than config.bits)."+t);return b.rng=r,!0},r.str2hex=function(r,e){var n,i,a,o,s,h,u="";if("string"!=typeof r)throw new Error("Input must be a character string.");if(e||(e=l.bytesPerChar),"number"!=typeof e||1>e||e>l.maxBytesPerChar||e%1!==0)throw new Error("Bytes per character must be an integer between 1 and "+l.maxBytesPerChar+", inclusive.");for(n=2*e,i=Math.pow(16,n)-1,s=0,h=r.length;h>s;s++){if(o=r[s].charCodeAt(),isNaN(o))throw new Error("Invalid character: "+r[s]);if(o>i)throw a=Math.ceil(Math.log(o+1)/Math.log(256)),new Error("Invalid character code ("+o+"). Maximum allowable is 256^bytes-1 ("+i+"). To convert this character, use at least "+a+" bytes.");u=t(o.toString(16),n)+u}return u},r.hex2str=function(r,e){var n,i,a,o="";if("string"!=typeof r)throw new Error("Input must be a hexadecimal string.");if(e=e||l.bytesPerChar,"number"!=typeof e||e%1!==0||1>e||e>l.maxBytesPerChar)throw new Error("Bytes per character must be an integer between 1 and "+l.maxBytesPerChar+", inclusive.");for(n=2*e,r=t(r,n),i=0,a=r.length;a>i;i+=n)o=String.fromCharCode(parseInt(r.slice(i,i+n),16))+o;return o},r.random=function(r){if("number"!=typeof r||r%1!==0||2>r||r>65536)throw new Error("Number of bits must be an Integer between 1 and 65536.");return i(b.rng(r))},r.share=function(r,e,a,s){var h,l,g,c,w,m=new Array(e),d=new Array(e);if(s=s||128,"string"!=typeof r)throw new Error("Secret must be a string.");if("number"!=typeof e||e%1!==0||2>e)throw new Error("Number of shares must be an integer between 2 and 2^bits-1 ("+b.maxShares+"), inclusive.");if(e>b.maxShares)throw h=Math.ceil(Math.log(e+1)/Math.LN2),new Error("Number of shares must be an integer between 2 and 2^bits-1 ("+b.maxShares+"), inclusive. To create "+e+" shares, use at least "+h+" bits.");if("number"!=typeof a||a%1!==0||2>a)throw new Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+b.maxShares+"), inclusive.");if(a>b.maxShares)throw h=Math.ceil(Math.log(a+1)/Math.LN2),new Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+b.maxShares+"), inclusive.  To use a threshold of "+a+", use at least "+h+" bits.");if(a>e)throw new Error("Threshold number of shares was "+a+" but must be less than or equal to the "+e+" shares specified as the total to generate.");if("number"!=typeof s||s%1!==0||0>s||s>1024)throw new Error("Zero-pad length must be an integer between 0 and 1024 inclusive.");for(r="1"+n(r),r=o(r,s),g=0,w=r.length;w>g;g++)for(l=u(r[g],e,a),c=0;e>c;c++)m[c]=m[c]||l[c].x.toString(b.radix),d[c]=t(l[c].y.toString(2))+(d[c]||"");for(g=0;e>g;g++)m[g]=f(b.bits,m[g],i(d[g]));return m},r.newShare=function(r,e){var t;if(r&&"string"==typeof r&&(r=parseInt(r,b.radix)),r&&e&&e[0])return t=this.extractShareComponents(e[0]),f(t.bits,r,this.combine(e,r));throw new Error("Invalid 'id' or 'shares' Array argument to newShare().")},r._padLeft=t,r._hex2bin=n,r._bin2hex=i,r._getRNG=a,r._isSetRNG=e,r._splitNumStringToIntArray=o,r._horner=s,r._lagrange=h,r._getShares=u,r._constructPublicShareString=f,r.init()}("undefined"!=typeof module&&module.exports?module.exports:window.secrets={});