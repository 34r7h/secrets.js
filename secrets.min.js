// secrets.js - Copyright (c) 2012 Alexander Stetsyuk
(function(exports, global){
function j(b){throw b;}var m=!0,n=null,p=!1,q="undefined"!==typeof module&&module.exports?module.exports:window.secrets={},r="undefined"!==typeof GLOBAL?GLOBAL:window;function t(b){b&&("number"!==typeof b||0!==b%1||b<u.o||b>u.m)&&j(Error("Number of bits must be an integer between "+u.o+" and "+u.m+", inclusive."));y.d=b||u.d;y.size=Math.pow(2,y.d);y.max=y.size-1;b=[];for(var c=[],a=1,d=u.N[y.d],f=0;f<y.size;f++)c[f]=a,b[a]=f,a<<=1,a>=y.size&&(a^=d,a&=y.max);y.f=b;y.l=c}
function z(){return!y.d||!y.size||!y.max||!y.f||!y.l||y.f.length!==y.size||y.l.length!==y.size?p:m}
function A(){function b(a,b,c,d){for(var l="",k=0,v=b.length-1;k<v||l.length<a;)l+=B(parseInt(b[k],c).toString(2),d),k++;l=l.substr(-a);return(l.match(/0/g)||[]).length===l.length?n:l}var c,a;if("function"===typeof require&&(a=require("crypto"))&&(c=a.randomBytes))return function(a){for(var d=Math.ceil(a/8),g=n;g===n;)g=b(a,c(d).toString("hex"),16,4);return g};if(r.crypto&&"function"===typeof r.crypto.getRandomValues&&"function"===typeof r.Uint32Array)return a=r.crypto,function(c){for(var d=n,g=new r.Uint32Array(Math.ceil(c/
32));d===n;)a.getRandomValues(g),d=b(c,g,10,32);return d};y.H=m;C();var d=Math.pow(2,32)-1;return function(a){for(var c=Math.ceil(a/32),g=[],h=n;h===n;){for(h=0;h<c;h++)g[h]=Math.floor(Math.random()*d+1);h=b(a,g,10,32)}return h}}function C(){r.console.warn(u.I);"function"===typeof r.alert&&r.alert(u.I)}function D(b,c,a){b=(new E(b,c)).toString(2);a&&(b=B(b,a));c=[];for(a=b.length;a>y.d;a-=y.d)c.push(parseInt(b.slice(a-y.d,a),2));c.push(parseInt(b.slice(0,a),2));return c}
function B(b,c){c=c||y.d;var a=b.length%c;return(a?Array(c-a+1).join("0"):"")+b}
function F(b,c){c=c||u.i;var a=parseInt(b[0],36);a&&("number"!==typeof a||0!==a%1||a<u.o||a>u.m)&&j(Error("Number of bits must be an integer between "+u.o+" and "+u.m+", inclusive."));var d=Math.pow(2,a)-1,f=d.toString(c).length,e=parseInt(b.substr(1,f),c);("number"!==typeof e||0!==e%1||1>e||e>d)&&j(Error("Share id must be an integer between 1 and "+y.max+", inclusive."));b=b.substr(f+1);b.length||j(Error("Invalid share: zero-length share."));return{d:a,id:e,share:b}}
function G(b,c,a,d){for(var f,e,g=[],h=[],l="",k,v=0,w=c.length;v<w;v++){e=F(c[v],a);"undefined"===typeof f?f=e.d:e.d!==f&&j(Error("Mismatched shares: Different bit settings."));y.d!==f&&t(f);a:{k=0;for(var s=g.length;k<s;k++)if(g[k]===e.id){k=m;break a}k=p}if(!k){k=g.push(e.id)-1;e=D(e.share,a);for(var s=0,x=e.length;s<x;s++)h[s]=h[s]||[],h[s][k]=e[s]}}v=0;for(w=h.length;v<w;v++)l=B(H(b,g,h[v]).toString(2))+l;return(new E(l,2)).toString(d)}
function H(b,c,a){var d=0,f,e,g;e=0;for(var h=c.length;e<h;e++)if(a[e]){f=y.f[a[e]];for(g=0;g<h;g++)if(e!==g){if(b===c[g]){f=-1;break}f=(f+y.f[b^c[g]]-y.f[c[e]^c[g]]+y.max)%y.max}d=-1===f?d:d^y.l[f]}return d}function E(b,c){b!=n&&(c==n&&"string"!=typeof b?this.C(b,256):this.C(b,c))}function J(b,c,a,d,f,e){for(;0<=--e;){var g=c*this[b++]+a[d]+f;f=Math.floor(g/67108864);a[d++]=g&67108863}return f}
function K(b,c,a,d,f,e){var g=c&32767;for(c>>=15;0<=--e;){var h=this[b]&32767,l=this[b++]>>15,k=c*h+l*g,h=g*h+((k&32767)<<15)+a[d]+(f&1073741823);f=(h>>>30)+(k>>>15)+c*l+(f>>>30);a[d++]=h&1073741823}return f}function L(b,c,a,d,f,e){var g=c&16383;for(c>>=14;0<=--e;){var h=this[b]&16383,l=this[b++]>>14,k=c*h+l*g,h=g*h+((k&16383)<<14)+a[d]+f;f=(h>>28)+(k>>14)+c*l;a[d++]=h&268435455}return f}function M(b,c){var a=N[b.charCodeAt(c)];return a==n?-1:a}function O(){return new E(n)}
function P(b){var c=O();c.r(b);return c}var u={d:8,i:16,o:3,m:20,v:2,n:6,N:[n,n,1,3,3,5,3,3,29,17,9,5,83,27,43,3,45,9,39,39,9,5,3,33,27,9,71,39,9,5,83],I:"WARNING:\nA secure random number generator was not found.\nUsing Math.random(), which is NOT cryptographically strong!"},y={};q.getConfig=function(){return{bits:y.d}};q.init=t;
q.setRNG=function(b){z()||this.init();b=b||A();("function"!==typeof b||"string"!==typeof b(y.d)||!parseInt(b(y.d),2)||b(y.d).length>y.d||b(y.d).length<y.d)&&j(Error("Random number generator is invalid. Supply an RNG of the form function(bits){} that returns a string containing 'bits' number of random 1's and 0's."));y.p=b};
q.random=function(b){"function"!==typeof y.p&&this.setRNG();("number"!==typeof b||0!==b%1||2>b)&&j(Error("Number of bits must be an integer greater than 1."));y.H&&C();return this.convertBase(y.p(b),2,16)};
q.share=function(b,c,a,d,f,e){z()||this.init();"function"!==typeof y.p&&this.setRNG();e=e||0;d=d||u.i;f=f||u.i;"string"!==typeof b&&j(Error("Secret must be a string."));("number"!==typeof d||0!==d%1||2>d||36<d)&&j(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof f||0!==f%1||2>f||36<f)&&j(Error("Output radix must be an integer between 2 and 36, inclusive."));("number"!==typeof c||0!==c%1||2>c)&&j(Error("Number of shares must be an integer between 2 and 2^bits-1 ("+
y.max+"), inclusive."));if(c>y.max){var g=Math.ceil(Math.log(c+1)/Math.log(2));j(Error("Number of shares must be an integer between 2 and 2^bits-1 ("+y.max+"), inclusive. To create "+c+" shares, use at least "+g+" bits."))}("number"!==typeof a||0!==a%1||2>a)&&j(Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+y.max+"), inclusive."));a>y.max&&(g=Math.ceil(Math.log(a+1)/Math.log(2)),j(Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+y.max+
"), inclusive.  To use a threshold of "+a+", use at least "+g+" bits.")));("number"!==typeof e||0!==e%1)&&j(Error("Zero-pad length must be an integer greater than 1."));y.H&&C();b=D(b,d,e);d=Array(c);e=Array(c);for(var g=0,h=b.length;g<h;g++)for(var l=this._getShares(b[g],c,a),k=0;k<c;k++)d[k]=d[k]||l[k].x.toString(f),e[k]=B(l[k].y.toString(2))+(e[k]?e[k]:"");b=y.max.toString(f).length;for(g=0;g<c;g++)d[g]=y.d.toString(36)+B(d[g],b)+(new E(e[g],2)).toString(f);return d};
q._getShares=function(b,c,a){var d=[];b=[b];for(var f=1;f<a;f++)b[f]=parseInt(y.p(y.d),2);f=1;for(c+=1;f<c;f++){a=y.f[f];for(var e=0,g=b.length-1;0<=g;g--)e=0===e?b[g]:y.l[(a+y.f[e])%y.max]^b[g];d[f-1]={x:f,y:e}}return d};
q.newShare=function(b,c,a){a=a||u.i;("number"!==typeof a||0!==a%1||2>a||36<a)&&j(Error("Radix must be an integer between 2 and 36, inclusive."));"string"===typeof b&&(b=parseInt(b,a));var d=F(c[0],a),d=Math.pow(2,d.d)-1;("number"!==typeof b||0!==b%1||1>b||b>d)&&j(Error("Share id must be an integer between 1 and "+y.max+", inclusive."));d=d.toString(a).length;return y.d.toString(36)+B(b.toString(a),d)+G(b,c,a,a)};secrets._processShare=F;
q.combine=function(b,c,a){c=c||u.i;a=a||u.i;("number"!==typeof c||0!==c%1||2>c||36<c)&&j(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof a||0!==a%1||2>a||36<a)&&j(Error("Output radix must be an integer between 2 and 36, inclusive."));return G(0,b,c,a)};q._lagrange=H;
q.toHex=function(b,c){"string"!==typeof b&&j(Error("Input must be a character string."));c=c||u.v;("number"!==typeof c||0!==c%1||1>c||c>u.n)&&j(Error("Bytes per character must be an integer between 1 and "+u.n+", inclusive."));for(var a=2*c,d=Math.pow(16,a)-1,f="",e,g=0,h=b.length;g<h;g++){e=b[g].charCodeAt();isNaN(e)&&j(Error("Invalid character: "+b[g]));if(e>d){var l=Math.ceil(Math.log(e+1)/Math.log(256));j(Error("Invalid character code ("+e+"). Maximum allowable is 256^bytes-1 ("+d+"). To convert this character, use at least "+
l+" bytes."))}f=B(e.toString(16),a)+f}return f};q.toString=function(b,c){"string"!==typeof b&&j(Error("Input must be a hexadecimal string."));c=c||u.v;("number"!==typeof c||0!==c%1||1>c||c>u.n)&&j(Error("Bytes per character must be an integer between 1 and "+u.n+", inclusive."));var a=2*c,d="";b=B(b,a);for(var f=0,e=b.length;f<e;f+=a)d=String.fromCharCode(parseInt(b.slice(f,f+a),16))+d;return d};
q.convertBase=function(b,c,a){"string"!==typeof b&&j(Error("Input must be a number string."));("number"!==typeof c||0!==c%1||2>c||36<c)&&j(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof a||0!==a%1||2>a||36<a)&&j(Error("Output radix must be an integer between 2 and 36, inclusive."));return(new E(b,c)).toString(a)};q.init();
E.prototype={C:function(b,c){var a;if(16==c)a=4;else if(8==c)a=3;else if(256==c)a=8;else if(2==c)a=1;else if(32==c)a=5;else if(4==c)a=2;else{this.M(b,c);return}this.b=this.a=0;for(var d=b.length,f=p,e=0;0<=--d;){var g=8==a?b[d]&255:M(b,d);0>g?"-"==b.charAt(d)&&(f=m):(f=p,0==e?this[this.a++]=g:e+a>this.c?(this[this.a-1]|=(g&(1<<this.c-e)-1)<<e,this[this.a++]=g>>this.c-e):this[this.a-1]|=g<<e,e+=a,e>=this.c&&(e-=this.c))}8==a&&0!=(b[0]&128)&&(this.b=-1,0<e&&(this[this.a-1]|=(1<<this.c-e)-1<<e));this.h();
f&&E.ZERO.e(this,this)},M:function(b,c){this.r(0);c==n&&(c=10);for(var a=this.w(c),d=Math.pow(c,a),f=p,e=0,g=0,h=0;h<b.length;++h){var l=M(b,h);0>l?"-"==b.charAt(h)&&0==this.s()&&(f=m):(g=c*g+l,++e>=a&&(this.A(d),this.z(g,0),g=e=0))}0<e&&(this.A(Math.pow(c,e)),this.z(g,0));f&&E.ZERO.e(this,this)},r:function(b){this.a=1;this.b=0>b?-1:0;0<b?this[0]=b:-1>b?this[0]=b+DV:this.a=0},w:function(b){return Math.floor(Math.LN2*this.c/Math.log(b))},A:function(b){this[this.a]=this.j(0,b-1,this,0,0,this.a);++this.a;
this.h()},h:function(){for(var b=this.b&this.g;0<this.a&&this[this.a-1]==b;)--this.a},z:function(b,c){if(0!=b){for(;this.a<=c;)this[this.a++]=0;for(this[c]+=b;this[c]>=this.k;)this[c]-=this.k,++c>=this.a&&(this[this.a++]=0),++this[c]}},toString:function(b){if(0>this.b)return"-"+this.G().toString(b);if(16==b)b=4;else if(8==b)b=3;else if(2==b)b=1;else if(32==b)b=5;else if(4==b)b=2;else return this.P(b);var c=(1<<b)-1,a,d=p,f="",e=this.a,g=this.c-e*this.c%b;if(0<e--){if(g<this.c&&0<(a=this[e]>>g))d=
m,f=Q.charAt(a);for(;0<=e;)g<b?(a=(this[e]&(1<<g)-1)<<b-g,a|=this[--e]>>(g+=this.c-b)):(a=this[e]>>(g-=b)&c,0>=g&&(g+=this.c,--e)),0<a&&(d=m),d&&(f+=Q.charAt(a))}return d?f:"0"},P:function(b){b==n&&(b=10);if(0==this.s()||2>b||36<b)return"0";var c=this.w(b),c=Math.pow(b,c),a=P(c),d=O(),f=O(),e="";for(this.B(a,d,f);0<d.s();)e=(c+f.D()).toString(b).substr(1)+e,d.B(a,d,f);return f.D().toString(b)+e},B:function(b,c,a){var d=b.abs();if(!(0>=d.a)){var f=this.abs();if(f.a<d.a)c!=n&&c.r(0),a!=n&&this.copyTo(a);
else{a==n&&(a=O());var e=O(),g=this.b;b=b.b;var h=d[d.a-1],l=1,k;if(0!=(k=h>>>16))h=k,l+=16;if(0!=(k=h>>8))h=k,l+=8;if(0!=(k=h>>4))h=k,l+=4;if(0!=(k=h>>2))h=k,l+=2;0!=h>>1&&(l+=1);h=this.c-l;0<h?(d.F(h,e),f.F(h,a)):(d.copyTo(e),f.copyTo(a));d=e.a;f=e[d-1];if(0!=f){k=f*(1<<this.t)+(1<d?e[d-2]>>this.u:0);l=this.J/k;k=(1<<this.t)/k;var v=1<<this.u,w=a.a,s=w-d,x=c==n?O():c;e.q(s,x);0<=a.K(x)&&(a[a.a++]=1,a.e(x,a));E.ONE.q(d,x);for(x.e(e,e);e.a<d;)e[e.a++]=0;for(;0<=--s;){var I=a[--w]==f?this.g:Math.floor(a[w]*
l+(a[w-1]+v)*k);if((a[w]+=e.j(0,I,a,s,0,d))<I){e.q(s,x);for(a.e(x,a);a[w]<--I;)a.e(x,a)}}c!=n&&(a.L(d,c),g!=b&&E.ZERO.e(c,c));a.a=d;a.h();0<h&&a.O(h,a);0>g&&E.ZERO.e(a,a)}}}},s:function(){return 0>this.b?-1:0>=this.a||1==this.a&&0>=this[0]?0:1},abs:function(){return 0>this.b?this.G():this},K:function(b){var c=this.b-b.b;if(0!=c)return c;var a=this.a,c=a-b.a;if(0!=c)return 0>this.b?-c:c;for(;0<=--a;)if(0!=(c=this[a]-b[a]))return c;return 0},q:function(b,c){var a;for(a=this.a-1;0<=a;--a)c[a+b]=this[a];
for(a=b-1;0<=a;--a)c[a]=0;c.a=this.a+b;c.b=this.b},L:function(b,c){for(var a=b;a<this.a;++a)c[a-b]=this[a];c.a=Math.max(this.a-b,0);c.b=this.b},F:function(b,c){var a=b%this.c,d=this.c-a,f=(1<<d)-1,e=Math.floor(b/this.c),g=this.b<<a&this.g,h;for(h=this.a-1;0<=h;--h)c[h+e+1]=this[h]>>d|g,g=(this[h]&f)<<a;for(h=e-1;0<=h;--h)c[h]=0;c[e]=g;c.a=this.a+e+1;c.b=this.b;c.h()},O:function(b,c){c.b=this.b;var a=Math.floor(b/this.c);if(a>=this.a)c.a=0;else{var d=b%this.c,f=this.c-d,e=(1<<d)-1;c[0]=this[a]>>d;
for(var g=a+1;g<this.a;++g)c[g-a-1]|=(this[g]&e)<<f,c[g-a]=this[g]>>d;0<d&&(c[this.a-a-1]|=(this.b&e)<<f);c.a=this.a-a;c.h()}},e:function(b,c){for(var a=0,d=0,f=Math.min(b.a,this.a);a<f;)d+=this[a]-b[a],c[a++]=d&this.g,d>>=this.c;if(b.a<this.a){for(d-=b.b;a<this.a;)d+=this[a],c[a++]=d&this.g,d>>=this.c;d+=this.b}else{for(d+=this.b;a<b.a;)d-=b[a],c[a++]=d&this.g,d>>=this.c;d-=b.b}c.b=0>d?-1:0;-1>d?c[a++]=this.k+d:0<d&&(c[a++]=d);c.a=a;c.h()},copyTo:function(b){for(var c=this.a-1;0<=c;--c)b[c]=this[c];
b.a=this.a;b.b=this.b},D:function(){if(0>this.b){if(1==this.a)return this[0]-this.k;if(0==this.a)return-1}else{if(1==this.a)return this[0];if(0==this.a)return 0}return(this[1]&(1<<32-this.c)-1)<<this.c|this[0]},G:function(){var b=O();E.ZERO.e(this,b);return b}};var R;r.navigator&&r.navigator.appName?"Microsoft Internet Explorer"==r.navigator.appName?(E.prototype.j=K,R=30):"Netscape"!=r.navigator.appName?(E.prototype.j=J,R=26):(E.prototype.j=L,R=28):(E.prototype.j=K,R=30);E.prototype.c=R;
E.prototype.g=(1<<R)-1;E.prototype.k=1<<R;E.prototype.J=Math.pow(2,52);E.prototype.t=52-R;E.prototype.u=2*R-52;var Q="0123456789abcdefghijklmnopqrstuvwxyz",N=[],S,T;S=48;for(T=0;9>=T;++T)N[S++]=T;S=97;for(T=10;36>T;++T)N[S++]=T;S=65;for(T=10;36>T;++T)N[S++]=T;E.ZERO=P(0);E.ONE=P(1);
})(typeof module !== 'undefined' && module['exports'] ? module['exports'] : (window['secrets'] = {}), typeof GLOBAL !== 'undefined' ? GLOBAL : window );