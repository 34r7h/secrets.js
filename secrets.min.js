// secrets.js - Copyright (c) 2012 Alexander Stetsyuk
(function(exports, global){
function j(a){throw a;}var n=!0,r=null,s=!1,u=[r,r,1,3,3,5,3,3,29,17,9,5,83,27,43,3,45,9,39,39,9,5,3,33,27,9,71,39,9,5,83],w={};
exports.init=function(a,b){a&&("number"!==typeof a||0!==a%1||3>a||20<a)&&j(Error("Number of bits must be an integer between 3 and 20, inclusive."));b&&("number"!==typeof b||0!==b%1||2>b||36<b)&&j(Error("Radix must be an integer between 2 and 36, inclusive."));w.d=a||8;w.g=b||16;w.size=Math.pow(2,w.d);w.max=w.size-1;for(var c=[],d=[],e=1,g=u[w.d],f=0;f<w.size;f++)d[f]=e,c[e]=f,e<<=1,e>=w.size&&(e^=g,e&=w.max);w.f=c;w.k=d};
function x(){for(var a=["bits","radix","logs","exps"],b=0,c=a.length;b<c;b++)if(!w[a[b]])return s;return w.f.length!==w.size||w.k.length!==w.size?s:n}exports.getConfig=function(){return{bits:w.d,radix:w.g}};
function y(){function a(a,b,c,d){for(var h="",l=0,m=b.length-1;l<m||h.length<a;)h+=z(parseInt(b[l],c).toString(2),d),l++;h=h.substr(-a);return(h.match(/0/g)||[]).length===h.length?r:h}var b,c;if("function"===typeof global.require&&(c=global.require("crypto"))&&(b=c.randomBytes))return function(c){for(var d=Math.ceil(c/8),f=r;f===r;)f=a(c,b(d).toString("hex"),16,4);return f};if(global.crypto&&"function"===typeof global.crypto.getRandomValues&&"function"===typeof global.Uint32Array)return c=global.crypto,
function(b){for(var d=r,f=new global.Uint32Array(Math.ceil(b/32));d===r;)c.getRandomValues(f),d=a(b,f,10,32);return d};global.console.warn("WARNING:\nA secure random number generator was not found.\nUsing Math.random(), which is NOT cryptographically strong!");"function"===typeof global.alert&&global.alert("WARNING:\nA secure random number generator was not found.\nUsing Math.random(), which is NOT cryptographically strong!");var d=Math.pow(2,32)-1;return function(b){for(var c=Math.ceil(b/32),f=[],
k=r;k===r;){for(k=0;k<c;k++)f[k]=Math.floor(Math.random()*d+1);k=a(b,f,10,32)}return k}}exports.setRNG=function(a){x()||this.init();a=a||y();("function"!==typeof a||"string"!==typeof a(w.d)||!parseInt(a(w.d),2)||a(w.d).length>w.d||a(w.d).length<w.d)&&j(Error("Random number generator is invalid. Supply an RNG of the form function(bits){} that returns a string containing 'bits' number of random 1's and 0's."));w.j=a};
exports.random=function(a){"function"!==typeof w.j&&this.setRNG();("number"!==typeof a||0!==a%1||2>a)&&j(Error("Number of bits must be an integer greater than 1."));return this.convertBase(w.j(a),2,16)};
exports.share=function(a,b,c,d,e){x()||this.init();"function"!==typeof w.j&&this.setRNG();d=d||w.g;e=e||w.g;"string"!==typeof a&&j(Error("Secret must be a string."));("number"!==typeof d||0!==d%1||2>d||36<d)&&j(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof e||0!==e%1||2>e||36<e)&&j(Error("Output radix must be an integer between 2 and 36, inclusive."));("number"!==typeof b||0!==b%1||2>b)&&j(Error("Number of shares must be an integer between 2 and 2^bits-1 ("+
w.max+"), inclusive."));if(b>w.max){var g=Math.ceil(Math.log(b+1)/Math.log(2));j(Error("Number of shares must be an integer between 2 and 2^bits-1 ("+w.max+"), inclusive. To create "+b+" shares, use at least "+g+" bits."))}("number"!==typeof c||0!==c%1||2>c)&&j(Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+w.max+"), inclusive."));c>w.max&&(g=Math.ceil(Math.log(c+1)/Math.log(2)),j(Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+w.max+
"), inclusive.  To use a threshold of "+c+", use at least "+g+" bits.")));a=A(a,d);d=Array(b);for(var g=Array(b),f=0,k=a.length;f<k;f++){for(var h=b,l=c,m=[],p=[a[f]],q=1;q<l;q++)p[q]=parseInt(w.j(w.d),2);q=1;for(h+=1;q<h;q++){for(var l=w.f[q],v=0,t=p.length-1;0<=t;t--)v=0===v?p[t]:w.k[(l+w.f[v])%w.max]^p[t];m[q-1]={x:q,y:v}}subShares=m;for(m=0;m<b;m++)d[m]=d[m]||subShares[m].x.toString(e),g[m]=z(subShares[m].y.toString(2))+(g[m]?g[m]:"")}for(f=0;f<b;f++)d[f]=d[f]+"-"+(new B(g[f],2)).toString(e);
return d};function A(a,b){a=(new B(a,b)).toString(2);for(var c=[],d=a.length;d>w.d;d-=w.d)c.push(parseInt(a.slice(d-w.d,d),2));c.push(parseInt(a.slice(0,d),2));return c}function z(a,b){b=b||w.d;var c=a.length%b;return(c?Array(b-c+1).join("0"):"")+a}
exports.newShare=function(a,b,c){x()||this.init();c=c||w.g;("number"!==typeof c||0!==c%1||2>c||36<c)&&j(Error("Radix must be an integer between 2 and 36, inclusive."));"string"===typeof a&&(a=parseInt(a,c));("number"!==typeof a||0!==a%1||1>a||a>w.max)&&j(Error("Share id must be an integer between 1 and "+w.max+", inclusive."));return a.toString(c)+"-"+C(a,b,c,c)};
function C(a,b,c,d){for(var e=[],g=[],f=[],k="",h,l=0,m=b.length;l<m;l++){"string"===typeof b[l]?(e=b[l].split("-"),2!==e.length&&j(Error("Invalid share:\n"+b[l]))):"object"===typeof b[l]?(e[0]=b[l].id.toString(),e[1]=b[l].share.toString()):j(Error("Unknown share type:\n"+b[l]));e[0]=parseInt(e[0],c);a:{h=0;for(var p=g.length;h<p;h++)if(g[h]===e[0]){h=n;break a}h=s}if(!h){h=g.push(e[0])-1;e[1]=A(e[1],c);for(var p=0,q=e[1].length;p<q;p++)f[p]=f[p]||[],f[p][h]=e[1][p]}}l=0;for(m=f.length;l<m;l++){b=
f[l];c=0;p=h=e=void 0;h=0;for(q=g.length;h<q;h++)if(b[h]){e=w.f[b[h]];for(p=0;p<q;p++)if(h!==p){if(a===g[p]){e=-1;break}e=(e+w.f[a^g[p]]-w.f[g[h]^g[p]]+w.max)%w.max}c=-1===e?c:c^w.k[e]}k=z(c.toString(2))+k}return(new B(k,2)).toString(d)}
exports.combine=function(a,b,c){x()||this.init();b=b||w.g;c=c||w.g;("number"!==typeof b||0!==b%1||2>b||36<b)&&j(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof c||0!==c%1||2>c||36<c)&&j(Error("Output radix must be an integer between 2 and 36, inclusive."));return C(0,a,b,c)};
exports.toHex=function(a,b){"string"!==typeof a&&j(Error("Input must be a character string."));b=b||1;6<b&&j(Error("Maximum bytes per character is 6."));for(var c=2*b,d=Math.pow(16,c)-1,e="",g,f=0,k=a.length;f<k;f++){g=a[f].charCodeAt();isNaN(g)&&j(Error("Invalid character: "+a[f]));if(g>d){var h=Math.ceil(Math.log(g+1)/Math.log(256));j(Error("Invalid character code ("+g+"). Maximum allowable is 256^bytes-1 ("+d+"). To convert this character, use at least "+h+" bytes."))}e+=z(g.toString(16),c)}return e};
exports.toString=function(a,b){"string"!==typeof a&&j(Error("Input must be a hexadecimal string."));b=b||1;6<b&&j(Error("Maximum bytes per character is 6."));var c=2*b,d="";a=z(a,c);for(var e=0,g=a.length;e<g;e+=c)d+=String.fromCharCode(parseInt(a.slice(e,e+c),16));return d};
exports.convertBase=function(a,b,c){"string"!==typeof a&&j(Error("Input must be a number string."));("number"!==typeof b||0!==b%1||2>b||36<b)&&j(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof c||0!==c%1||2>c||36<c)&&j(Error("Output radix must be an integer between 2 and 36, inclusive."));return(new B(a,b)).toString(c)};exports.init();function B(a,b){a!=r&&(b==r&&"string"!=typeof a?D(this,a,256):D(this,a,b))}
B.prototype={toString:function(a){if(0>this.b)return"-"+E(this).toString(a);if(16==a)a=4;else if(8==a)a=3;else if(2==a)a=1;else if(32==a)a=5;else if(4==a)a=2;else{var b;b=a;b==r&&(b=10);if(0==F(this)||2>b||36<b)b="0";else{a=Math.floor(Math.LN2*this.c/Math.log(b));a=Math.pow(b,a);var c=G(a),d=H(),e=H(),g="";for(I(this,c,d,e);0<F(d);)g=(a+J(e)).toString(b).substr(1)+g,I(d,c,d,e);b=J(e).toString(b)+g}return b}var c=(1<<a)-1,d=s,e="",g=this.a,f=this.c-g*this.c%a;if(0<g--){if(f<this.c&&0<(b=this[g]>>f))d=
n,e=K.charAt(b);for(;0<=g;)f<a?(b=(this[g]&(1<<f)-1)<<a-f,b|=this[--g]>>(f+=this.c-a)):(b=this[g]>>(f-=a)&c,0>=f&&(f+=this.c,--g)),0<b&&(d=n),d&&(e+=K.charAt(b))}return d?e:"0"},abs:function(){return 0>this.b?E(this):this},copyTo:function(a){for(var b=this.a-1;0<=b;--b)a[b]=this[b];a.a=this.a;a.b=this.b}};function E(a){var b=H();M(N,a,b);return b}
function J(a){if(0>a.b){if(1==a.a)return a[0]-a.i;if(0==a.a)return-1}else{if(1==a.a)return a[0];if(0==a.a)return 0}return(a[1]&(1<<32-a.c)-1)<<a.c|a[0]}function M(a,b,c){for(var d=0,e=0,g=Math.min(b.a,a.a);d<g;)e+=a[d]-b[d],c[d++]=e&a.e,e>>=a.c;if(b.a<a.a){for(e-=b.b;d<a.a;)e+=a[d],c[d++]=e&a.e,e>>=a.c;e+=a.b}else{for(e+=a.b;d<b.a;)e-=b[d],c[d++]=e&a.e,e>>=a.c;e-=b.b}c.b=0>e?-1:0;-1>e?c[d++]=a.i+e:0<e&&(c[d++]=e);c.a=d;O(c)}
function P(a,b,c){var d=b%a.c,e=a.c-d,g=(1<<e)-1;b=Math.floor(b/a.c);var f=a.b<<d&a.e,k;for(k=a.a-1;0<=k;--k)c[k+b+1]=a[k]>>e|f,f=(a[k]&g)<<d;for(k=b-1;0<=k;--k)c[k]=0;c[b]=f;c.a=a.a+b+1;c.b=a.b;O(c)}function Q(a,b,c){var d;for(d=a.a-1;0<=d;--d)c[d+b]=a[d];for(d=b-1;0<=d;--d)c[d]=0;c.a=a.a+b;c.b=a.b}function R(a,b){var c=a.b-b.b;if(0!=c)return c;var d=a.a,c=d-b.a;if(0!=c)return 0>a.b?-c:c;for(;0<=--d;)if(0!=(c=a[d]-b[d]))return c;return 0}
function F(a){return 0>a.b?-1:0>=a.a||1==a.a&&0>=a[0]?0:1}
function I(a,b,c,d){var e=b.abs();if(!(0>=e.a)){var g=a.abs();if(g.a<e.a)c!=r&&S(c,0),d!=r&&a.copyTo(d);else{d==r&&(d=H());var f=H(),k=a.b;b=b.b;var h=e[e.a-1],l=1,m;if(0!=(m=h>>>16))h=m,l+=16;if(0!=(m=h>>8))h=m,l+=8;if(0!=(m=h>>4))h=m,l+=4;if(0!=(m=h>>2))h=m,l+=2;0!=h>>1&&(l+=1);h=a.c-l;0<h?(P(e,h,f),P(g,h,d)):(e.copyTo(f),g.copyTo(d));e=f.a;g=f[e-1];if(0!=g){m=g*(1<<a.l)+(1<e?f[e-2]>>a.m:0);l=a.n/m;m=(1<<a.l)/m;var p=1<<a.m,q=d.a,v=q-e,t=c==r?H():c;Q(f,v,t);0<=R(d,t)&&(d[d.a++]=1,M(d,t,d));Q(aa,
e,t);for(M(t,f,f);f.a<e;)f[f.a++]=0;for(;0<=--v;){var L=d[--q]==g?a.e:Math.floor(d[q]*l+(d[q-1]+p)*m);if((d[q]+=f.h(0,L,d,v,0,e))<L){Q(f,v,t);for(M(d,t,d);d[q]<--L;)M(d,t,d)}}if(c!=r){a=d;for(f=e;f<a.a;++f)c[f-e]=a[f];c.a=Math.max(a.a-e,0);c.b=a.b;k!=b&&M(N,c,c)}d.a=e;O(d);if(0<h)if(b=c=d,b.b=c.b,a=Math.floor(h/c.c),a>=c.a)b.a=0;else{h%=c.c;f=c.c-h;e=(1<<h)-1;b[0]=c[a]>>h;for(g=a+1;g<c.a;++g)b[g-a-1]|=(c[g]&e)<<f,b[g-a]=c[g]>>h;0<h&&(b[c.a-a-1]|=(c.b&e)<<f);b.a=c.a-a;O(b)}0>k&&M(N,d,d)}}}}
function T(a,b){var c=0;if(0!=b){for(;a.a<=c;)a[a.a++]=0;for(a[c]+=b;a[c]>=a.i;)a[c]-=a.i,++c>=a.a&&(a[a.a++]=0),++a[c]}}function O(a){for(var b=a.b&a.e;0<a.a&&a[a.a-1]==b;)--a.a}function U(a,b){a[a.a]=a.h(0,b-1,a,0,0,a.a);++a.a;O(a)}function S(a,b){a.a=1;a.b=0>b?-1:0;0<b?a[0]=b:-1>b?a[0]=b+DV:a.a=0}
function D(a,b,c){if(16==c)c=4;else if(8==c)c=3;else if(256==c)c=8;else if(2==c)c=1;else if(32==c)c=5;else if(4==c)c=2;else{S(a,0);c==r&&(c=10);for(var d=Math.floor(Math.LN2*a.c/Math.log(c)),e=Math.pow(c,d),g=s,f=0,k=0,h=0;h<b.length;++h){var l=V(b,h);0>l?"-"==b.charAt(h)&&0==F(a)&&(g=n):(k=c*k+l,++f>=d&&(U(a,e),T(a,k),k=f=0))}0<f&&(U(a,Math.pow(c,f)),T(a,k));g&&M(N,a,a);return}a.a=0;a.b=0;d=b.length;e=s;for(g=0;0<=--d;)f=8==c?b[d]&255:V(b,d),0>f?"-"==b.charAt(d)&&(e=n):(e=s,0==g?a[a.a++]=f:g+c>a.c?
(a[a.a-1]|=(f&(1<<a.c-g)-1)<<g,a[a.a++]=f>>a.c-g):a[a.a-1]|=f<<g,g+=c,g>=a.c&&(g-=a.c));8==c&&0!=(b[0]&128)&&(a.b=-1,0<g&&(a[a.a-1]|=(1<<a.c-g)-1<<g));O(a);e&&M(N,a,a)}function ba(a,b,c,d,e,g){for(;0<=--g;){var f=b*this[a++]+c[d]+e;e=Math.floor(f/67108864);c[d++]=f&67108863}return e}function W(a,b,c,d,e,g){var f=b&32767;for(b>>=15;0<=--g;){var k=this[a]&32767,h=this[a++]>>15,l=b*k+h*f,k=f*k+((l&32767)<<15)+c[d]+(e&1073741823);e=(k>>>30)+(l>>>15)+b*h+(e>>>30);c[d++]=k&1073741823}return e}
function ca(a,b,c,d,e,g){var f=b&16383;for(b>>=14;0<=--g;){var k=this[a]&16383,h=this[a++]>>14,l=b*k+h*f,k=f*k+((l&16383)<<14)+c[d]+e;e=(k>>28)+(l>>14)+b*h;c[d++]=k&268435455}return e}function V(a,b){var c=X[a.charCodeAt(b)];return c==r?-1:c}var Y;global.navigator&&global.navigator.appName?"Microsoft Internet Explorer"==global.navigator.appName?(B.prototype.h=W,Y=30):"Netscape"!=global.navigator.appName?(B.prototype.h=ba,Y=26):(B.prototype.h=ca,Y=28):(B.prototype.h=W,Y=30);B.prototype.c=Y;
B.prototype.e=(1<<Y)-1;B.prototype.i=1<<Y;B.prototype.n=Math.pow(2,52);B.prototype.l=52-Y;B.prototype.m=2*Y-52;var K="0123456789abcdefghijklmnopqrstuvwxyz",X=[],Z,$;Z=48;for($=0;9>=$;++$)X[Z++]=$;Z=97;for($=10;36>$;++$)X[Z++]=$;Z=65;for($=10;36>$;++$)X[Z++]=$;function H(){return new B(r)}function G(a){var b=H();S(b,a);return b}var N=G(0),aa=G(1);
})(typeof module !== 'undefined' && module['exports'] ? module['exports'] : (window['secrets'] = {}), typeof GLOBAL !== 'undefined' ? GLOBAL : window );