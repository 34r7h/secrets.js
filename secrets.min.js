// secrets.js - Copyright (c) 2012 Alexander Stetsyuk
(function(exports, global){
function m(a){throw a;}var q=!0,r=null,s=!1,aa=[r,r,1,3,3,5,3,3,29,17,9,5,83,27,43,3,45,9,39,39,9,5,3,33,27,9,71,39,9,5,83],t="WARNING:\nA secure random number generator was not found.\nUsing Math.random(), which is NOT cryptographically strong!",v,x,y,z,A,B,C,D;
exports.init=function(a,b){a&&("number"!==typeof a||0!==a%1||3>a||20<a)&&m(Error("Number of bits must be an integer between 3 and 20, inclusive."));b&&("number"!==typeof b||0!==b%1||2>b||36<b)&&m(Error("Radix must be an integer between 2 and 36, inclusive."));v=a||8;x=b||16;y=Math.pow(2,v);z=y-1;for(var c=[],d=[],e=1,g=aa[v],f=0;f<y;f++)d[f]=e,c[e]=f,e<<=1,e>=y&&(e^=g,e&=z);A=c;B=d};function E(){return!v||!x||!A||!B||!y||!z||A.length!==y||B.length!==y?s:q}
exports.getConfig=function(){return{bits:v,radix:x}};
function ba(){function a(a,b,c,d){for(var h="",k=0,l=b.length-1;k<l||h.length<a;)h+=F(parseInt(b[k],c).toString(2),d),k++;h=h.substr(-a);return(h.match(/0/g)||[]).length===h.length?r:h}var b,c;if("function"===typeof global.require&&(c=global.require("crypto"))&&(b=c.randomBytes))return function(c){for(var d=Math.ceil(c/8),f=r;f===r;)f=a(c,b(d).toString("hex"),16,4);return f};if(global.crypto&&"function"===typeof global.crypto.getRandomValues&&"function"===typeof global.Uint32Array)return c=global.crypto,
function(b){for(var d=r,f=new global.Uint32Array(Math.ceil(b/32));d===r;)c.getRandomValues(f),d=a(b,f,10,32);return d};C=q;G();var d=Math.pow(2,32)-1;return function(b){for(var c=Math.ceil(b/32),f=[],j=r;j===r;){for(j=0;j<c;j++)f[j]=Math.floor(Math.random()*d+1);j=a(b,f,10,32)}return j}}function G(){global.console.warn(t);"function"===typeof global.alert&&global.alert(t)}
exports.setRNG=function(a){E()||this.init();a=a||ba();("function"!==typeof a||"string"!==typeof a(v)||!parseInt(a(v),2)||a(v).length>v||a(v).length<v)&&m(Error("Random number generator is invalid. Supply an RNG of the form function(bits){} that returns a string containing 'bits' number of random 1's and 0's."));D=a};
exports.random=function(a){"function"!==typeof D&&this.setRNG();C&&G();("number"!==typeof a||0!==a%1||2>a)&&m(Error("Number of bits must be an integer greater than 1."));return this.convertBase(D(a),2,16)};
exports.share=function(a,b,c,d,e){E()||this.init();"function"!==typeof D&&this.setRNG();C&&G();d=d||x;e=e||x;"string"!==typeof a&&m(Error("Secret must be a string."));("number"!==typeof d||0!==d%1||2>d||36<d)&&m(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof e||0!==e%1||2>e||36<e)&&m(Error("Output radix must be an integer between 2 and 36, inclusive."));("number"!==typeof b||0!==b%1||2>b)&&m(Error("Number of shares must be an integer between 2 and 2^bits-1 ("+
z+"), inclusive."));if(b>z){var g=Math.ceil(Math.log(b+1)/Math.log(2));m(Error("Number of shares must be an integer between 2 and 2^bits-1 ("+z+"), inclusive. To create "+b+" shares, use at least "+g+" bits."))}("number"!==typeof c||0!==c%1||2>c)&&m(Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+z+"), inclusive."));c>z&&(g=Math.ceil(Math.log(c+1)/Math.log(2)),m(Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+z+"), inclusive.  To use a threshold of "+
c+", use at least "+g+" bits.")));a=H(a,d);d=Array(b);for(var g=Array(b),f=0,j=a.length;f<j;f++){for(var h=b,k=c,l=[],n=[a[f]],p=1;p<k;p++)n[p]=parseInt(D(v),2);p=1;for(h+=1;p<h;p++){for(var k=A[p],w=0,u=n.length-1;0<=u;u--)w=0===w?n[u]:B[(k+A[w])%z]^n[u];l[p-1]={x:p,y:w}}subShares=l;for(l=0;l<b;l++)d[l]=d[l]||subShares[l].x.toString(e),g[l]=F(subShares[l].y.toString(2))+(g[l]?g[l]:"")}for(f=0;f<b;f++)d[f]=d[f]+"-"+(new I(g[f],2)).toString(e);return d};
function H(a,b){a=(new I(a,b)).toString(2);for(var c=[],d=a.length;d>v;d-=v)c.push(parseInt(a.slice(d-v,d),2));c.push(parseInt(a.slice(0,d),2));return c}function F(a,b){b=b||v;var c=a.length%b;return(c?Array(b-c+1).join("0"):"")+a}
exports.newShare=function(a,b,c){E()||this.init();c=c||x;("number"!==typeof c||0!==c%1||2>c||36<c)&&m(Error("Radix must be an integer between 2 and 36, inclusive."));"string"===typeof a&&(a=parseInt(a,c));("number"!==typeof a||0!==a%1||1>a||a>z)&&m(Error("Share id must be an integer between 1 and "+z+", inclusive."));return a.toString(c)+"-"+J(a,b,c,c)};
function J(a,b,c,d){for(var e=[],g=[],f=[],j="",h,k=0,l=b.length;k<l;k++){"string"===typeof b[k]?(e=b[k].split("-"),2!==e.length&&m(Error("Invalid share:\n"+b[k]))):"object"===typeof b[k]?(e[0]=b[k].id.toString(),e[1]=b[k].share.toString()):m(Error("Unknown share type:\n"+b[k]));e[0]=parseInt(e[0],c);a:{h=0;for(var n=g.length;h<n;h++)if(g[h]===e[0]){h=q;break a}h=s}if(!h){h=g.push(e[0])-1;e[1]=H(e[1],c);for(var n=0,p=e[1].length;n<p;n++)f[n]=f[n]||[],f[n][h]=e[1][n]}}k=0;for(l=f.length;k<l;k++){b=
f[k];c=0;n=h=e=void 0;h=0;for(p=g.length;h<p;h++)if(b[h]){e=A[b[h]];for(n=0;n<p;n++)if(h!==n){if(a===g[n]){e=-1;break}e=(e+A[a^g[n]]-A[g[h]^g[n]]+z)%z}c=-1===e?c:c^B[e]}j=F(c.toString(2))+j}return(new I(j,2)).toString(d)}
exports.combine=function(a,b,c){E()||this.init();b=b||x;c=c||x;("number"!==typeof b||0!==b%1||2>b||36<b)&&m(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof c||0!==c%1||2>c||36<c)&&m(Error("Output radix must be an integer between 2 and 36, inclusive."));return J(0,a,b,c)};
exports.toHex=function(a,b){"string"!==typeof a&&m(Error("Input must be a character string."));b=b||1;6<b&&m(Error("Maximum bytes per character is 6."));for(var c=2*b,d=Math.pow(16,c)-1,e="",g,f=0,j=a.length;f<j;f++){g=a[f].charCodeAt();isNaN(g)&&m(Error("Invalid character: "+a[f]));if(g>d){var h=Math.ceil(Math.log(g+1)/Math.log(256));m(Error("Invalid character code ("+g+"). Maximum allowable is 256^bytes-1 ("+d+"). To convert this character, use at least "+h+" bytes."))}e+=F(g.toString(16),c)}return e};
exports.toString=function(a,b){"string"!==typeof a&&m(Error("Input must be a hexadecimal string."));b=b||1;6<b&&m(Error("Maximum bytes per character is 6."));var c=2*b,d="";a=F(a,c);for(var e=0,g=a.length;e<g;e+=c)d+=String.fromCharCode(parseInt(a.slice(e,e+c),16));return d};
exports.convertBase=function(a,b,c){"string"!==typeof a&&m(Error("Input must be a number string."));("number"!==typeof b||0!==b%1||2>b||36<b)&&m(Error("Input radix must be an integer between 2 and 36, inclusive."));("number"!==typeof c||0!==c%1||2>c||36<c)&&m(Error("Output radix must be an integer between 2 and 36, inclusive."));return(new I(a,b)).toString(c)};exports.init();function I(a,b){a!=r&&(b==r&&"string"!=typeof a?K(this,a,256):K(this,a,b))}
I.prototype={toString:function(a){if(0>this.b)return"-"+L(this).toString(a);if(16==a)a=4;else if(8==a)a=3;else if(2==a)a=1;else if(32==a)a=5;else if(4==a)a=2;else{var b;b=a;b==r&&(b=10);if(0==M(this)||2>b||36<b)b="0";else{a=Math.floor(Math.LN2*this.c/Math.log(b));a=Math.pow(b,a);var c=N(a),d=O(),e=O(),g="";for(P(this,c,d,e);0<M(d);)g=(a+Q(e)).toString(b).substr(1)+g,P(d,c,d,e);b=Q(e).toString(b)+g}return b}var c=(1<<a)-1,d=s,e="",g=this.a,f=this.c-g*this.c%a;if(0<g--){if(f<this.c&&0<(b=this[g]>>f))d=
q,e=ca.charAt(b);for(;0<=g;)f<a?(b=(this[g]&(1<<f)-1)<<a-f,b|=this[--g]>>(f+=this.c-a)):(b=this[g]>>(f-=a)&c,0>=f&&(f+=this.c,--g)),0<b&&(d=q),d&&(e+=ca.charAt(b))}return d?e:"0"},abs:function(){return 0>this.b?L(this):this},copyTo:function(a){for(var b=this.a-1;0<=b;--b)a[b]=this[b];a.a=this.a;a.b=this.b}};function L(a){var b=O();R(S,a,b);return b}
function Q(a){if(0>a.b){if(1==a.a)return a[0]-a.f;if(0==a.a)return-1}else{if(1==a.a)return a[0];if(0==a.a)return 0}return(a[1]&(1<<32-a.c)-1)<<a.c|a[0]}function R(a,b,c){for(var d=0,e=0,g=Math.min(b.a,a.a);d<g;)e+=a[d]-b[d],c[d++]=e&a.d,e>>=a.c;if(b.a<a.a){for(e-=b.b;d<a.a;)e+=a[d],c[d++]=e&a.d,e>>=a.c;e+=a.b}else{for(e+=a.b;d<b.a;)e-=b[d],c[d++]=e&a.d,e>>=a.c;e-=b.b}c.b=0>e?-1:0;-1>e?c[d++]=a.f+e:0<e&&(c[d++]=e);c.a=d;U(c)}
function da(a,b,c){var d=b%a.c,e=a.c-d,g=(1<<e)-1;b=Math.floor(b/a.c);var f=a.b<<d&a.d,j;for(j=a.a-1;0<=j;--j)c[j+b+1]=a[j]>>e|f,f=(a[j]&g)<<d;for(j=b-1;0<=j;--j)c[j]=0;c[b]=f;c.a=a.a+b+1;c.b=a.b;U(c)}function V(a,b,c){var d;for(d=a.a-1;0<=d;--d)c[d+b]=a[d];for(d=b-1;0<=d;--d)c[d]=0;c.a=a.a+b;c.b=a.b}function ea(a,b){var c=a.b-b.b;if(0!=c)return c;var d=a.a,c=d-b.a;if(0!=c)return 0>a.b?-c:c;for(;0<=--d;)if(0!=(c=a[d]-b[d]))return c;return 0}
function M(a){return 0>a.b?-1:0>=a.a||1==a.a&&0>=a[0]?0:1}
function P(a,b,c,d){var e=b.abs();if(!(0>=e.a)){var g=a.abs();if(g.a<e.a)c!=r&&W(c,0),d!=r&&a.copyTo(d);else{d==r&&(d=O());var f=O(),j=a.b;b=b.b;var h=e[e.a-1],k=1,l;if(0!=(l=h>>>16))h=l,k+=16;if(0!=(l=h>>8))h=l,k+=8;if(0!=(l=h>>4))h=l,k+=4;if(0!=(l=h>>2))h=l,k+=2;0!=h>>1&&(k+=1);h=a.c-k;0<h?(da(e,h,f),da(g,h,d)):(e.copyTo(f),g.copyTo(d));e=f.a;g=f[e-1];if(0!=g){l=g*(1<<a.g)+(1<e?f[e-2]>>a.h:0);k=a.i/l;l=(1<<a.g)/l;var n=1<<a.h,p=d.a,w=p-e,u=c==r?O():c;V(f,w,u);0<=ea(d,u)&&(d[d.a++]=1,R(d,u,d));V(fa,
e,u);for(R(u,f,f);f.a<e;)f[f.a++]=0;for(;0<=--w;){var T=d[--p]==g?a.d:Math.floor(d[p]*k+(d[p-1]+n)*l);if((d[p]+=f.e(0,T,d,w,0,e))<T){V(f,w,u);for(R(d,u,d);d[p]<--T;)R(d,u,d)}}if(c!=r){a=d;for(f=e;f<a.a;++f)c[f-e]=a[f];c.a=Math.max(a.a-e,0);c.b=a.b;j!=b&&R(S,c,c)}d.a=e;U(d);if(0<h)if(b=c=d,b.b=c.b,a=Math.floor(h/c.c),a>=c.a)b.a=0;else{h%=c.c;f=c.c-h;e=(1<<h)-1;b[0]=c[a]>>h;for(g=a+1;g<c.a;++g)b[g-a-1]|=(c[g]&e)<<f,b[g-a]=c[g]>>h;0<h&&(b[c.a-a-1]|=(c.b&e)<<f);b.a=c.a-a;U(b)}0>j&&R(S,d,d)}}}}
function ga(a,b){var c=0;if(0!=b){for(;a.a<=c;)a[a.a++]=0;for(a[c]+=b;a[c]>=a.f;)a[c]-=a.f,++c>=a.a&&(a[a.a++]=0),++a[c]}}function U(a){for(var b=a.b&a.d;0<a.a&&a[a.a-1]==b;)--a.a}function ha(a,b){a[a.a]=a.e(0,b-1,a,0,0,a.a);++a.a;U(a)}function W(a,b){a.a=1;a.b=0>b?-1:0;0<b?a[0]=b:-1>b?a[0]=b+DV:a.a=0}
function K(a,b,c){if(16==c)c=4;else if(8==c)c=3;else if(256==c)c=8;else if(2==c)c=1;else if(32==c)c=5;else if(4==c)c=2;else{W(a,0);c==r&&(c=10);for(var d=Math.floor(Math.LN2*a.c/Math.log(c)),e=Math.pow(c,d),g=s,f=0,j=0,h=0;h<b.length;++h){var k=ia(b,h);0>k?"-"==b.charAt(h)&&0==M(a)&&(g=q):(j=c*j+k,++f>=d&&(ha(a,e),ga(a,j),j=f=0))}0<f&&(ha(a,Math.pow(c,f)),ga(a,j));g&&R(S,a,a);return}a.a=0;a.b=0;d=b.length;e=s;for(g=0;0<=--d;)f=8==c?b[d]&255:ia(b,d),0>f?"-"==b.charAt(d)&&(e=q):(e=s,0==g?a[a.a++]=f:
g+c>a.c?(a[a.a-1]|=(f&(1<<a.c-g)-1)<<g,a[a.a++]=f>>a.c-g):a[a.a-1]|=f<<g,g+=c,g>=a.c&&(g-=a.c));8==c&&0!=(b[0]&128)&&(a.b=-1,0<g&&(a[a.a-1]|=(1<<a.c-g)-1<<g));U(a);e&&R(S,a,a)}function ja(a,b,c,d,e,g){for(;0<=--g;){var f=b*this[a++]+c[d]+e;e=Math.floor(f/67108864);c[d++]=f&67108863}return e}
function ka(a,b,c,d,e,g){var f=b&32767;for(b>>=15;0<=--g;){var j=this[a]&32767,h=this[a++]>>15,k=b*j+h*f,j=f*j+((k&32767)<<15)+c[d]+(e&1073741823);e=(j>>>30)+(k>>>15)+b*h+(e>>>30);c[d++]=j&1073741823}return e}function la(a,b,c,d,e,g){var f=b&16383;for(b>>=14;0<=--g;){var j=this[a]&16383,h=this[a++]>>14,k=b*j+h*f,j=f*j+((k&16383)<<14)+c[d]+e;e=(j>>28)+(k>>14)+b*h;c[d++]=j&268435455}return e}function ia(a,b){var c=X[a.charCodeAt(b)];return c==r?-1:c}var Y;
global.navigator&&global.navigator.appName?"Microsoft Internet Explorer"==global.navigator.appName?(I.prototype.e=ka,Y=30):"Netscape"!=global.navigator.appName?(I.prototype.e=ja,Y=26):(I.prototype.e=la,Y=28):(I.prototype.e=ka,Y=30);I.prototype.c=Y;I.prototype.d=(1<<Y)-1;I.prototype.f=1<<Y;I.prototype.i=Math.pow(2,52);I.prototype.g=52-Y;I.prototype.h=2*Y-52;var ca="0123456789abcdefghijklmnopqrstuvwxyz",X=[],Z,$;Z=48;for($=0;9>=$;++$)X[Z++]=$;Z=97;for($=10;36>$;++$)X[Z++]=$;Z=65;
for($=10;36>$;++$)X[Z++]=$;function O(){return new I(r)}function N(a){var b=O();W(b,a);return b}var S=N(0),fa=N(1);
})(typeof module !== 'undefined' && module['exports'] ? module['exports'] : (window['secrets'] = {}), typeof GLOBAL !== 'undefined' ? GLOBAL : window );